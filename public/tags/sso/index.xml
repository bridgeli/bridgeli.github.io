<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Sso on 分享技术带来的喜悦</title>
    <link>http://localhost:1313/tags/sso/</link>
    <description>Recent content in Sso on 分享技术带来的喜悦</description>
    <generator>Hugo -- 0.156.0</generator>
    <language>zh-cn</language>
    <lastBuildDate>Sun, 26 Dec 2021 08:24:00 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/sso/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>JWT 实际应用例子</title>
      <link>http://localhost:1313/posts/2021-12-26-jwt-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E4%BE%8B%E5%AD%90/</link>
      <pubDate>Sun, 26 Dec 2021 08:24:00 +0000</pubDate>
      <guid>http://localhost:1313/posts/2021-12-26-jwt-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E4%BE%8B%E5%AD%90/</guid>
      <description>&lt;p&gt;JWT 是什么，很多网站都有例子，但是如何使用，却不是很多，今天就介绍一个很具体的、能在项目中实际应用的例子。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;pom&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
&amp;lt;dependency&amp;gt;  
&amp;lt;groupId&amp;gt;io.jsonwebtoken&amp;lt;/groupId&amp;gt;  
&amp;lt;artifactId&amp;gt;jjwt&amp;lt;/artifactId&amp;gt;  
&amp;lt;version&amp;gt;0.9.1&amp;lt;/version&amp;gt;  
&amp;lt;/dependency&amp;gt;  
&amp;lt;dependency&amp;gt;  
&amp;lt;groupId&amp;gt;com.auth0&amp;lt;/groupId&amp;gt;  
&amp;lt;artifactId&amp;gt;java-jwt&amp;lt;/artifactId&amp;gt;  
&amp;lt;version&amp;gt;3.4.0&amp;lt;/version&amp;gt;  
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Java 代码&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
package cn.bridgeli.demo;

import io.jsonwebtoken.Claims;  
import io.jsonwebtoken.JwtBuilder;  
import io.jsonwebtoken.Jwts;  
import io.jsonwebtoken.SignatureAlgorithm;

import java.util.Date;  
import java.util.HashMap;  
import java.util.Map;  
import java.util.UUID;

public class JwtUtil {  
static String key = &amp;#34;key&amp;#34;;

/**  
* 用户登录成功后生成Jwt  
* 使用Hs256算法 私匙使用用户密码  
*  
* @param ttlMillis jwt过期时间  
* @param user 登录成功的user对象  
* @return  
*/  
public static String createJWT(long ttlMillis, User user) {  
//指定签名的时候使用的签名算法，也就是header那部分，jjwt已经将这部分内容封装好了。  
SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;

//生成JWT的时间  
long nowMillis = System.currentTimeMillis();  
Date now = new Date(nowMillis);

//创建payload的私有声明（根据特定的业务需要添加，如果要拿这个做验证，一般是需要和jwt的接收方提前沟通好验证方式的）  
Map&amp;lt;String, Object&amp;gt; claims = new HashMap&amp;lt;&amp;gt;();  
// claims.put(&amp;#34;id&amp;#34;, user.getId());  
claims.put(&amp;#34;username&amp;#34;, user.getUsername());  
// claims.put(&amp;#34;password&amp;#34;, user.getPassword());

//生成签发人  
String subject = user.getUsername();

//下面就是在为payload添加各种标准声明和私有声明了  
//这里其实就是new一个JwtBuilder，设置jwt的body  
JwtBuilder builder = Jwts.builder()  
//如果有私有声明，一定要先设置这个自己创建的私有的声明，这个是给builder的claim赋值，一旦写在标准的声明赋值之后，就是覆盖了那些标准的声明的  
.setClaims(claims)  
//设置jti(JWT ID)：是JWT的唯一标识，根据业务需要，这个可以设置为一个不重复的值，主要用来作为一次性token,从而回避重放攻击。  
.setId(UUID.randomUUID().toString())  
//iat: jwt的签发时间  
.setIssuedAt(now)  
//代表这个JWT的主体，即它的所有人，这个是一个json格式的字符串，可以存放什么userid，roldid之类的，作为什么用户的唯一标志。  
.setSubject(subject)  
//设置签名使用的签名算法和签名使用的秘钥  
.signWith(signatureAlgorithm, key);  
if (ttlMillis &amp;gt;= 0) {  
long expMillis = nowMillis + ttlMillis;  
Date exp = new Date(expMillis);  
//设置过期时间  
builder.setExpiration(exp);  
}  
return builder.compact();  
}

/**  
* Token的解密  
*  
* @param token 加密后的token  
* @param user 用户的对象  
* @return  
*/  
public static Claims parseJWT(String token, User user) {  
//签名秘钥，和生成的签名的秘钥一模一样

//得到DefaultJwtParser  
Claims claims = Jwts.parser()  
//设置签名的秘钥  
.setSigningKey(key)  
//设置需要解析的jwt  
.parseClaimsJws(token).getBody();  
return claims;  
}

/**  
* 校验token  
* 在这里可以使用官方的校验，我这里校验的是token中携带的密码于数据库一致的话就校验通过  
*  
* @param token  
* @param user  
* @return  
*/  
public static Boolean isVerify(String token, User user) {  
//签名秘钥，和生成的签名的秘钥一模一样

//得到DefaultJwtParser  
Claims claims = Jwts.parser()  
//设置签名的秘钥  
.setSigningKey(key)  
//设置需要解析的jwt  
.parseClaimsJws(token).getBody();

if (claims.get(&amp;#34;username&amp;#34;).equals(user.getUsername())) {  
return true;  
}

return false;  
}  
}
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
  </channel>
</rss>
