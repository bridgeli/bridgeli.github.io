<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Aspect on 分享技术带来的喜悦</title>
    <link>http://localhost:1313/tags/aspect/</link>
    <description>Recent content in Aspect on 分享技术带来的喜悦</description>
    <generator>Hugo -- 0.156.0</generator>
    <language>zh-cn</language>
    <lastBuildDate>Sun, 15 Mar 2020 07:32:50 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/aspect/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Spring AOP 实现自定义注解</title>
      <link>http://localhost:1313/posts/2020-03-15-spring-aop-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/</link>
      <pubDate>Sun, 15 Mar 2020 07:32:50 +0000</pubDate>
      <guid>http://localhost:1313/posts/2020-03-15-spring-aop-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/</guid>
      <description>&lt;p&gt;自工作后，除了一些小项目配置事务使用过 AOP，真正自己写 AOP 机会很少，另一方面在工作后还没有写过自定义注解，一直很好奇注解是怎么实现他想要的功能的，刚好做项目的时候，经常有人日志打得不够全，经常出现问题了，查日志的才发现忘记打了，所以趁此机会，搜了一些资料，用 AOP + 自定义注解，实现请求拦截，自定义打日志，玩一下这两个东西，以下是自己完的一个小例子，也供需要的同学参考。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;注解如下：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
package cn.bridgeli.demo.annotation;

import java.lang.annotation.ElementType;  
import java.lang.annotation.Retention;  
import java.lang.annotation.RetentionPolicy;  
import java.lang.annotation.Target;

/**  
* @author bridgeli  
*/  
@Target(ElementType.METHOD)  
@Retention(RetentionPolicy.RUNTIME)  
public @interface MyLog {  
/**  
* 方法描述  
*  
* @return  
*/  
String desc() default &amp;#34;&amp;#34;;  
}
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;切面&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
package cn.bridgeli.demo.annotation;

import cn.bridgeli.utils.AuthorizeUtil;  
import cn.bridgeli.entity.Principal;  
import lombok.extern.slf4j.Slf4j;  
import org.apache.commons.lang3.StringUtils;  
import org.aspectj.lang.ProceedingJoinPoint;  
import org.aspectj.lang.annotation.Around;  
import org.aspectj.lang.annotation.Aspect;  
import org.aspectj.lang.annotation.Pointcut;  
import org.springframework.stereotype.Component;

/**  
* @author bridgeli  
* 1. 这是一个切面类  
*/  
@Aspect  
@Component  
@Slf4j  
public class MyLogAspect {

/**  
* 2. PointCut表示这是一个切点，@annotation表示这个切点切到一个注解上，后面带该注解的全类名  
* 切面最主要的就是切点，所有的故事都围绕切点发生  
* logPointCut()代表切点名称  
*/  
@Pointcut(&amp;#34;@annotation(cn.bridgeli.demo.annotation.MyLog)&amp;#34;)  
public void logPointCut() {  
}

/**  
* 3. 环绕通知  
*  
* @param joinPoint  
* @param myLog  
* @return  
*/  
@Around(value = &amp;#34;logPointCut() &amp;amp;&amp;amp; @annotation(myLog)&amp;#34;, argNames = &amp;#34;joinPoint,myLog&amp;#34;)  
public Object logAround(ProceedingJoinPoint joinPoint, MyLog myLog) {  
// 获取方法名  
String methodFullPathName = joinPoint.getTarget().getClass().getName() + &amp;#34;#&amp;#34; + joinPoint.getSignature().getName();

// 获取参数  
String params = StringUtils.join(joinPoint.getArgs(), &amp;#34;;&amp;#34;);

Principal currentUser = AuthorizeUtil.getCurrentUser();  
log.info(&amp;#34;当前登陆用户：&amp;#34; + (null == currentUser ? &amp;#34;&amp;#34; : currentUser.toString()) + &amp;#34;，进入 [ &amp;#34; + methodFullPathName + &amp;#34; ] 方法, 方法的描述：&amp;#34; + myLog.desc() + &amp;#34;，参数为:&amp;#34; + params);

// 继续执行方法  
long startTime = System.currentTimeMillis();  
Object result = null;  
try {  
result = joinPoint.proceed();  
} catch (Throwable e) {  
log.error(&amp;#34;切面执行报错，参数：&amp;#34; + params, e);  
}  
long elapsed = System.currentTimeMillis() &amp;amp;#8211; startTime;

log.info(&amp;#34;[ &amp;#34; + methodFullPathName + &amp;#34; ] 方法执行结束，返回值为：&amp;#34; + (null == result ? &amp;#34;&amp;#34; : result.toString()) + &amp;#34;，用时：&amp;#34; + elapsed);

return result;  
}  
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后只需要在想使用的地方 @MyLog 就可以了，当然也可以加上 @MyLog(desc = “这是方法描述”)，这样打出来的日志还会有方法是做什么的，别人看日志的时候能够一目了然。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
