<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>文件损坏 on 分享技术带来的喜悦</title>
    <link>http://localhost:1313/tags/%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F/</link>
    <description>Recent content in 文件损坏 on 分享技术带来的喜悦</description>
    <generator>Hugo -- 0.156.0</generator>
    <language>zh-cn</language>
    <lastBuildDate>Sun, 13 Jan 2019 09:10:03 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Maven 打包 Excel 文件损坏</title>
      <link>http://localhost:1313/posts/2019-01-13-maven-%E6%89%93%E5%8C%85-excel-%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F/</link>
      <pubDate>Sun, 13 Jan 2019 09:10:03 +0000</pubDate>
      <guid>http://localhost:1313/posts/2019-01-13-maven-%E6%89%93%E5%8C%85-excel-%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F/</guid>
      <description>&lt;p&gt;前几天在项目中遇到一个小问题，有一个 Excel 文件放在 classpath 下，通过流下载下来，本地测试的时候一点问题都没，但是部署到测试环境却不行了，说文件已损坏，然后打不开，简单代码如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
@RequestMapping(value = &amp;#34;/export&amp;#34;, method = RequestMethod.GET)  
public void export(HttpServletResponse response) {

ServletOutputStream servletOutputStream = null;  
String filename = &amp;#34;template.xlsx&amp;#34;;  
InputStream inputStream = ExcelHandleController.class.getClassLoader().getResourceAsStream(filename);  
try {  
byte[] b = new byte[inputStream.available()];  
inputStream.read(b);  
response.setCharacterEncoding(StandardCharsets.UTF_8.name());  
response.setHeader(&amp;#34;Content-Disposition&amp;#34;, &amp;#34;attachment;filename=&amp;#34; + filename);  
response.setContentType(&amp;#34;application/octet-stream;charset=UTF-8&amp;#34;);  
//获取响应报文输出流对象  
servletOutputStream = response.getOutputStream();  
//输出  
servletOutputStream.write(b);  
} catch (IOException e) {  
logger.error(&amp;#34;文件下载出错&amp;#34;, e);  
} finally {  
if (null != inputStream) {  
try {  
inputStream.close();  
} catch (IOException e) {  
logger.error(&amp;#34;文件下载出错&amp;#34;, e);  
}  
}  
if (null != servletOutputStream) {  
try {  
servletOutputStream.flush();  
servletOutputStream.close();  
} catch (IOException e) {  
logger.error(&amp;#34;文件下载出错&amp;#34;, e);  
}

}

}

}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;当时就感觉这代码很简单啊，没什么问题的，但是下载下来就是不对，想到是不是测试环境有什么问题，查了一下没什么特殊之处，最后发现 Git 上的代码中的文件并没有什么问题，但是打成 war 包解压之后这文件本身就已经损坏了，而且比对了一下两个文件，发现 war 包之中的文件变大了，搜了一下资料，才知道原来 maven 打包会对一些文件转码，这个过程中会损坏一些文件，所以打不开，网上的资料也挺多，最简单的就是增加一个 plugin，不让该文件转码，代码如下：&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
