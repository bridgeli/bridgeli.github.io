<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>负载均衡 on 分享技术带来的喜悦</title>
    <link>http://localhost:1313/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</link>
    <description>Recent content in 负载均衡 on 分享技术带来的喜悦</description>
    <generator>Hugo -- 0.156.0</generator>
    <language>zh-cn</language>
    <lastBuildDate>Sun, 17 May 2015 14:07:24 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Nginx配置使用入门</title>
      <link>http://localhost:1313/posts/2015-05-17-nginx%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/</link>
      <pubDate>Sun, 17 May 2015 14:07:24 +0000</pubDate>
      <guid>http://localhost:1313/posts/2015-05-17-nginx%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/</guid>
      <description>&lt;p&gt;Nginx作为当今数一数二的负载均衡服务器，应用十分广泛，今天记录一下，大名鼎鼎的Nginx的配置信息&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;一个简单的负载均衡的示例，把www.domain.com均衡到本机不同的端口，也可以改为均衡到不同的地址上。&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
http {  
upstream myproject {  
server 127.0.0.1:8000 weight=3;  
server 127.0.0.1:8001;  
server 127.0.0.1:8002;  
server 127.0.0.1:8003;  
}

server {  
listen 80;  
server_name www.domain.com;  
location / {  
proxy_pass http://myproject;  
}  
}  
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;weight就是权重，数值越大，分配到这个服务器的概率就越大，以本例来说，分配8000上的概率为二分之一，其他的三个均为为六分之一，另外需要注意的是：proxy_pass和upstream一定要一样&lt;/p&gt;
&lt;p&gt;注：这么配置仅仅是解决了负载均衡的问题，但是没有解决session共享的问题，为了解决session共享我们有两个方案：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;配置粘连，也就是说，只要某一个请求被分配到该服务器，那么今后的该客端的所有请求全都分配到该服务器上；&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在代码中解决session共享问题&lt;br&gt;
目前针对这两种方案，我都不是很熟悉，我将来会写一篇文章来解决这个问题&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;静态资源处理&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
location ~ .(jpg|png|jpeg|bmp|gif|swf|css|js)$ {  
expires 30d;  
root /nginx-1.8.0;#root  
break;  
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;就是说上面的这些静态资源文件都是相对于：/nginx-1.8.0的，所以如果我们代码中写的路径是img/bridgeli.png，那么我们就需要在nginx-1.8.0建一个img目录，把我们bridgeli.png放在里面。&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;完整示例&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
#!nginx  
\# 使用的用户和组  
user www www;  
\# 指定工作衍生进程数  
worker_processes 2;  
\# 指定 pid 存放的路径  
pid /var/run/nginx.pid;

\# [ debug | info | notice | warn | error | crit ]  
\# 可以在下方直接使用 [ debug | info | notice | warn | error | crit ] 参数  
error_log /var/log/nginx.error_log info;

events {  
\# 允许的连接数  
connections 2000;  
\# use [ kqueue | rtsig | epoll | /dev/poll | select | poll ] ;  
\# 具体内容查看 http://wiki.codemongers.com/事件模型  
use kqueue;  
}

http {  
include conf/mime.types;  
default_type application/octet-stream;

log_format main &amp;amp;#8216;$remote_addr &amp;amp;#8211; $remote_user [$time_local] &amp;amp;#8216;  
&amp;amp;#8216;&amp;#34;$request&amp;#34; $status $bytes_sent &amp;amp;#8216;  
&amp;amp;#8216;&amp;#34;$http_referer&amp;#34; &amp;#34;$http_user_agent&amp;#34; &amp;amp;#8216;  
&amp;amp;#8216;&amp;#34;$gzip_ratio&amp;#34;&amp;amp;#8217;;

log_format download &amp;amp;#8216;$remote_addr &amp;amp;#8211; $remote_user [$time_local] &amp;amp;#8216;  
&amp;amp;#8216;&amp;#34;$request&amp;#34; $status $bytes_sent &amp;amp;#8216;  
&amp;amp;#8216;&amp;#34;$http_referer&amp;#34; &amp;#34;$http_user_agent&amp;#34; &amp;amp;#8216;  
&amp;amp;#8216;&amp;#34;$http_range&amp;#34; &amp;#34;$sent_http_content_range&amp;#34;&amp;amp;#8217;;

client_header_timeout 3m;  
client_body_timeout 3m;  
send_timeout 3m;

client_header_buffer_size 1k;  
large_client_header_buffers 4 4k;

gzip on;  
gzip_min_length 1100;  
gzip_buffers 4 8k;  
gzip_types text/plain;

output_buffers 1 32k;  
postpone_output 1460;

sendfile on;  
tcp_nopush on;  
tcp_nodelay on;  
send_lowat 12000;

keepalive_timeout 75 20;

#lingering_time 30;  
#lingering_timeout 10;  
#reset_timedout_connection on;

server {  
listen one.example.com;  
server_name one.example.com www.one.example.com;

access_log /var/log/nginx.access_log main;

location / {  
proxy_pass http://127.0.0.1/;  
proxy_redirect off;

proxy_set_header Host $host;  
proxy_set_header X-Real-IP $remote_addr;  
#proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

client_max_body_size 10m;  
client_body_buffer_size 128k;

client_body_temp_path /var/nginx/client_body_temp;

proxy_connect_timeout 90;  
proxy_send_timeout 90;  
proxy_read_timeout 90;  
proxy_send_lowat 12000;

proxy_buffer_size 4k;  
proxy_buffers 4 32k;  
proxy_busy_buffers_size 64k;  
proxy_temp_file_write_size 64k;

proxy_temp_path /var/nginx/proxy_temp;

charset UTF-8;  
}

error_page 404 /404.html;

location /404.html {  
root /spool/www;

charset on;  
source_charset UTF-8;  
}

location /old_stuff/ {  
rewrite ^/old_stuff/(.*)$ /new_stuff/$1 permanent;  
}

location /download/ {

valid_referers none blocked server_names *.example.com;

if ($invalid_referer) {  
#rewrite ^/ http://www.example.com/;  
return 403;  
}

#rewrite_log on;

\# rewrite /download/\*/mp3/\*.any_ext to /download/\*/mp3/\*.mp3  
rewrite ^/(download/.\*)/mp3/(.\*)..*$  
/$1/mp3/$2.mp3 break;

root /spool/www;  
#autoindex on;  
access_log /var/log/nginx-download.access_log download;  
}

location ~* ^.+.(jpg|jpeg|gif)$ {  
root /spool/www;  
access_log off;  
expires 30d;  
}  
}  
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这是Nginx官方网站的一个例子，说实话里面的很多配置我也不是很清楚，但很多并不是非常难以理解&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
