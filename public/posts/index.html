<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>æ–‡ç«  | åˆ†äº«æŠ€æœ¯å¸¦æ¥çš„å–œæ‚¦</title>
<meta name="keywords" content="">
<meta name="description" content="æ–‡ç«  - åˆ†äº«æŠ€æœ¯å¸¦æ¥çš„å–œæ‚¦">
<meta name="author" content="Bridge Li">
<link rel="canonical" href="http://localhost:1313/posts/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a29c24210eb31d9ce56f669c66a35c9c51b17376b7764e336a49af7dec914cf0.css" integrity="sha256-opwkIQ6zHZzlb2acZqNcnFGxc3a3dk4zakmvfeyRTPA=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/posts/index.xml" title="rss">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
</head>
<body class="list" id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="åˆ†äº«æŠ€æœ¯å¸¦æ¥çš„å–œæ‚¦ (Alt + H)">åˆ†äº«æŠ€æœ¯å¸¦æ¥çš„å–œæ‚¦</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="æ–‡ç« ">
                    <span class="active">æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="å…³äº">
                    <span>å…³äº</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="http://localhost:1313/">Home</a></div>
  <h1>
    æ–‡ç« 
  </h1>
</header>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">åšå®¢æ¬å®¶è¯´æ˜
    </h2>
  </header>
  <div class="entry-content">
    <p>ä¹‹å‰çš„åšå®¢æ˜¯åœ¨é˜¿é‡Œäº‘ä¹°çš„æœåŠ¡å™¨ï¼Œå¹³å‡æ¯å¤©å°†è¿‘å…«æ¯›é’±ï¼Œè‡ªä»å¤§æ¨¡å‹é—®ä¸–ä¹‹åï¼Œå†™åšå®¢çš„æ¬²æœ›èŠèƒœäºæ— ï¼Œæ‰€ä»¥ç»å¸¸å¾ˆä¹…ä¸æ›´æ–°äº†ï¼Œä½†æ˜¯æ„Ÿè§‰æ¯å¤©éƒ½ä»˜è¿™é’±å¤ªäºäº†ï¼Œæ‰€ä»¥é©¬å¹´ä¸Šç­ç¬¬ä¸€å¤©æŠŠåšå®¢è¿ç§»åˆ°äº† GitHub pagesï¼Œå› ä¸ºè¿ç§»çš„æ¯”è¾ƒéšä¾¿ï¼Œæ‰€ä»¥ 1. åšå®¢é‡Œé¢åµŒå…¥çš„ä»£ç éƒ½ä¹±æ‰äº†ï¼Œä¸è¿‡è¿˜å¥½ç°åœ¨æœ‰å¤§æ¨¡å‹äº†ï¼Œä¹Ÿä¸éœ€è¦æ‹·è´ä»£ç äº†ï¼Œæ‰€ä»¥ä¹Ÿæ‡’å¾—æ•´ç†äº†ï¼Œ2 å°±æ˜¯ä¹‹å‰æœ‰äº›åšå®¢å¸¦å›¾ï¼Œå›¾è¿˜åœ¨ï¼Œä½†éœ€è¦ä¸€ä¸€æ›¿æ¢ï¼Œä¹Ÿæ‡’å¾—å¼„äº†ï¼Œæ‰€ä»¥å›¾ç‰‡èµ„æºä¹Ÿæ²¡æœ‰äº†ï¼Œ3. å°±æ˜¯è¯„è®ºéƒ½ä¸¢å¤±äº†ï¼Œå…¶å®ä¹‹å‰ä¹Ÿæ²¡å‡ ä¸ªè¯„è®ºï¼Œä¹Ÿéƒ½æ²¡å•¥ä»·å€¼ï¼Œå°±æ²¡è¿ç§»ï¼Œåç»­çœ‹çœ‹è¿˜åŠ ä¸åŠ è¯„è®ºæ¡†å§ï¼Œä¹‹å‰ä¸€ç›´è‡ªå»ºåšå®¢ï¼Œä¸€æ–¹é¢æ˜¯æ‡’ï¼Œä¸æƒ³åŠ¨ï¼Œå¦ä¸€æ–¹é¢æ˜¯æ¯”è¾ƒå–œæ¬¢ inove è¿™ä¸ªä¸»é¢˜ï¼Œç‰¹æ­¤è¯´æ˜ã€‚
</p>
  </div>
  <footer class="entry-footer"><span title='2026-02-24 07:47:09 +0000 +0000'>February 24, 2026</span>&nbsp;Â·&nbsp;<span>1 min</span>&nbsp;Â·&nbsp;<span>9 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to åšå®¢æ¬å®¶è¯´æ˜" href="http://localhost:1313/posts/2026-02-24-blog-migtate-explain/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">ä¸€æ¬¡ç³»ç»Ÿå“åº”æ…¢çš„æ’æŸ¥
    </h2>
  </header>
  <div class="entry-content">
    <p>å…ˆè¯´ä¸€ä¸‹ï¼Œç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯ï¼Œä¸€å…±ä¸¤ä¸ªç³»ç»Ÿåˆ†åˆ«ç§°å‘¼æ˜¯ A å’Œ B å§ã€‚1. ä¸¤ä¸ªç³»ç»Ÿéƒ½æ²¡æœ‰æºç ï¼›2. A æ˜¯ springboot é¡¹ç›®ï¼ŒB æ˜¯ä¼ ç»Ÿçš„ Tomcatï¼›3. ä¸¤è€…éƒ½æ˜¯ä½¿ç”¨å†…ç½‘ IP åœ°å€è¿æ¥åŒä¸€ä¸ªæ•°æ®åº“ï¼›4. ä¸¤ä¸ªç³»ç»ŸåŒ…æ‹¬æ•°æ®åº“éƒ½æ˜¯ä¸€ä¸ªæœˆå‰è€æœåŠ¡å™¨è¿ç§»åˆ°äº†æ–°æœåŠ¡å™¨ã€‚è¡¨ç°æ˜¯ A ç³»ç»Ÿä¹Ÿå°±æ˜¯ springboot ç³»ç»Ÿå“åº”é€Ÿåº¦æ­£å¸¸ï¼ŒB ç³»ç»Ÿä¹Ÿå°±æ˜¯é‚£ä¸ª Tomcat ç³»ç»Ÿå“åº”é€Ÿåº¦ç›¸å¯¹æ­£å¸¸ï¼Œå°±æ˜¯æœ‰ä¸€ç‚¹æ…¢ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰æ”¾åœ¨å¿ƒä¸Šï¼Œå†…éƒ¨ç³»ç»Ÿï¼Œèƒ½ç”¨ï¼Œæœ‰ä¸€å¤©å‘ç° B ç³»ç»Ÿçš„æŸä¸ªæ¥å£ç‰¹åˆ«ç‰¹åˆ«æ…¢ï¼Œä»¥è‡³äºä¼šå“åº”è¶…æ—¶ï¼Œç„¶åæ’æŸ¥è¿™ä¸ªé—®é¢˜ï¼Œè¿˜æœ‰å°±æ˜¯ç›®å‰åªå‘ç°äº†è¿™ä¸€ä¸ªæ¥å£æ…¢ï¼ŒA ç³»ç»Ÿæœ‰ä¸€ä¸ªç±»ä¼¼åŠŸèƒ½çš„æ¥å£ï¼Œå“åº”é€Ÿåº¦ä¹Ÿæ­£å¸¸ã€‚
å½“æ—¶çœ‹åˆ°è¿™ä¸ªå“åº”ï¼Œç¬¬ä¸€ååº”ï¼šB ç³»ç»Ÿæœ‰ä¸ªé…ç½®é”™äº†ï¼Œå› ä¸ºä¸€ä¸ªæœˆå‰åˆšè¿ç§»äº†ç³»ç»Ÿï¼Œè€Œ B ç³»ç»Ÿä¸€å…±æœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼Œéœ€è¦é…ç½®æ•°æ®åº“è¿æ¥ï¼Œæœ‰ä¸ªåœ°æ–¹å¿˜è®°ä¿®æ”¹äº†ï¼Œåˆšå¥½è¿™ä¸ªæ¥å£ç”¨çš„æ˜¯è¿™ä¸ªç³»ç»Ÿçš„é…ç½®æ–‡ä»¶çš„è¿æ¥åœ°å€ï¼Œæ‰€ä»¥è°ƒç”¨æ•°æ®åº“è¿æ¥è¶…æ—¶æŠ¥é”™ï¼Œç»æ’æŸ¥å‘ç°ä¸‰ä¸ªåœ°å€çš„é…ç½®å‡ä¿®æ”¹äº†ï¼Œæ˜¯æ­£ç¡®çš„ã€‚
åœ¨ä¸Šä¸€æ­¥çš„æ’æŸ¥ä¸­ä¹Ÿæ²¡æœ‰å‘ç°æœ‰ä»»ä½•æŠ¥é”™æ—¥å¿—ï¼Œæ‰€ä»¥ç¬¬äºŒååº”ï¼Œå‡ºç°äº†æ…¢æŸ¥è¯¢ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸å¤ªåº”è¯¥ï¼Œæ•°æ®åº“æ˜¯å®Œæ•´è¿ç§»çš„ï¼Œä»¥å‰ä¹Ÿä¸æ…¢å•Šï¼Œè€Œä¸” A ç³»ç»Ÿæœ‰ä¸ªåŠŸèƒ½ç±»ä¼¼çš„æ¥å£ï¼Œå“åº”é€Ÿåº¦ä¹Ÿç®—æ­£å¸¸ã€‚å…¶å®æ­£å¸¸æ˜¯çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œçœ‹æœ‰æ²¡æœ‰ç›¸å…³çš„ SQLï¼Œä½†æ˜¯ç³»ç»Ÿæ²¡æœ‰è®°å½•ï¼Œæ‰€ä»¥é€šè¿‡ SQL è¯­å¥æŸ¥è¯¢ï¼š
SELECT trx_id AS äº‹åŠ¡ID, trx_state AS çŠ¶æ€, trx_started AS å¼€å§‹æ—¶é—´, trx_mysql_thread_id AS çº¿ç¨‹ID, TIME_TO_SEC(TIMEDIFF(NOW(), trx_started)) AS å·²è¿è¡Œç§’æ•°, trx_query AS å½“å‰SQL FROM information_schema.INNODB_TRX ORDER BY trx_started\G ç»æŸ¥è¯¢ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£çš„æ—¶å€™ï¼Œæ²¡æœ‰è¶…é•¿æ‰§è¡Œçš„ SQL è¯­å¥æ‰€ä»¥æ’é™¤ã€‚
ç„¶åä¸‹ä¸€ä¸ªæ’æŸ¥æ–¹å‘æ˜¯ä¸æ˜¯ jdbc çš„é©±åŠ¨ç‰ˆæœ¬ä¸å¯¹ï¼ŒB ç³»ç»Ÿçš„ jdbc ç‰ˆæœ¬è¿˜æ˜¯ 5 ç‚¹å‡ ï¼Œè€Œæ•°æ®åº“çš„ç‰ˆæœ¬å·²ç»æ˜¯ 8 ç‚¹å‡ ï¼Œè¿™æœ‰ç‚¹å¯¹ä¸ä¸Šå•Šï¼Œå¤§æ¨¡å‹è¯´ 8 ç‚¹å‡ çš„è®¤è¯æ–¹å¼ä¿®æ”¹äº†ï¼Œæ‰€ä»¥é‚£å°±ä¿®æ”¹ jdbc çš„ç‰ˆæœ¬æµ‹è¯•ï¼Œç„¶åæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2026-02-02 06:10:09 +0000 +0000'>February 2, 2026</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>222 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to ä¸€æ¬¡ç³»ç»Ÿå“åº”æ…¢çš„æ’æŸ¥" href="http://localhost:1313/posts/2026-02-02-%E4%B8%80%E6%AC%A1%E7%B3%BB%E7%BB%9F%E5%93%8D%E5%BA%94%E6%85%A2%E7%9A%84%E6%8E%92%E6%9F%A5/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">æœ¬åœ°å¼€å‘ä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒç‰ˆæœ¬ JDK çš„è§£å†³æ–¹æ¡ˆ
    </h2>
  </header>
  <div class="entry-content">
    <p>ä¸€èˆ¬æˆ‘ä»¬åœ¨å…¬å¸å·¥ä½œä¸­ï¼Œå¾ˆå°‘æœ‰äººå°±è´Ÿè´£ä¸€ä¸ªé¡¹ç›®ï¼Œè€Œè´Ÿè´£ä¸åŒçš„é¡¹ç›®ï¼Œç”±äºå„ç§åŸå› ä½¿ç”¨çš„ JDK ç‰ˆæœ¬å¯èƒ½å¹¶ä¸ç›¸åŒï¼Œå¦‚æœå­˜åœ¨ä¸å…¼å®¹çš„æƒ…å†µï¼Œé‚£ä¹ˆæœ¬åœ° mvn clean compile çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬å»ä¿®æ”¹æˆ‘ä»¬è®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼Œå¦‚æœå¤šä¸ªé¡¹ç›®åŒæ—¶å¼€å‘ï¼Œé‚£ä¹ˆå°±éœ€è¦æ—¶ä¸æ—¶åˆ‡æ¥åˆ‡å»ï¼Œç‰¹åˆ«çƒ¦äººï¼Œå…¶å®è¿™ä¸ªé—®é¢˜ maven æ—©å°±æ›¿å¤§å®¶è€ƒè™‘è¿‡äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ï¼š
ä¿®æ”¹ maven çš„ toolchains.xml æ–‡ä»¶ &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;!&amp;#8211; Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the &#34;License&#34;); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &#34;AS IS&#34; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. &amp;#8211;&gt; &lt;!&amp;#8211; | This is the toolchains file for Maven. It can be specified at two levels: | | 1. User Level. This toolchains.xml file provides configuration for a single user, | and is normally provided in ${user.home}/.m2/toolchains.xml. | | NOTE: This location can be overridden with the CLI option: | | -t /path/to/user/toolchains.xml | | 2. Global Level. This toolchains.xml file provides configuration for all Maven | users on a machine (assuming they&amp;#8217;re all using the same Maven | installation). It&amp;#8217;s normally provided in | ${maven.conf}/toolchains.xml. | | NOTE: This location can be overridden with the CLI option: | | -gt /path/to/global/toolchains.xml | | The sections in this sample file are intended to give you a running start at | getting the most out of your Maven installation. |&amp;#8211;&gt; &lt;toolchains xmlns=&#34;http://maven.apache.org/TOOLCHAINS/1.1.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/TOOLCHAINS/1.1.0 http://maven.apache.org/xsd/toolchains-1.1.0.xsd&#34;&gt; &lt;!&amp;#8211; | With toolchains you can refer to installations on your system. This | way you don&amp;#8217;t have to hardcode paths in your pom.xml. | | Every toolchain consist of 3 elements: | * type: the type of tool. An often used value is &amp;#8216;jdk&amp;#8217;. Toolchains-aware | plugins should document which type you must use. | | * provides: A list of key/value-pairs. | Based on the toolchain-configuration in the pom.xml Maven will search for | matching &lt;provides/&gt; configuration. You can decide for yourself which key-value | pairs to use. Often used keys are &amp;#8216;version&amp;#8217;, &amp;#8216;vendor&amp;#8217; and &amp;#8216;arch&amp;#8217;. By default | the version has a special meaning. If you configured in the pom.xml &amp;#8216;1.5&amp;#8217; | Maven will search for 1.5 and above. | | * configuration: Additional configuration for this tool. | Look for documentation of the toolchains-aware plugin which configuration elements | can be used. | | See also https://maven.apache.org/guides/mini/guide-using-toolchains.html | | General example &lt;toolchain&gt; &lt;type/&gt; &lt;provides&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/provides&gt; &lt;configuration/&gt; &lt;/toolchain&gt; | JDK examples &lt;toolchain&gt; &lt;type&gt;jdk&lt;/type&gt; &lt;provides&gt; &lt;version&gt;1.5&lt;/version&gt; &lt;vendor&gt;sun&lt;/vendor&gt; &lt;/provides&gt; &lt;configuration&gt; &lt;jdkHome&gt;/path/to/jdk/1.5&lt;/jdkHome&gt; &lt;/configuration&gt; &lt;/toolchain&gt; &lt;toolchain&gt; &lt;type&gt;jdk&lt;/type&gt; &lt;provides&gt; &lt;version&gt;1.6&lt;/version&gt; &lt;vendor&gt;sun&lt;/vendor&gt; &lt;/provides&gt; &lt;configuration&gt; &lt;jdkHome&gt;/path/to/jdk/1.6&lt;/jdkHome&gt; &lt;/configuration&gt; &lt;/toolchain&gt; &amp;#8211;&gt; &lt;toolchain&gt; &lt;type&gt;jdk&lt;/type&gt; &lt;provides&gt; &lt;version&gt;17&lt;/version&gt; &lt;/provides&gt; &lt;configuration&gt; &lt;jdkHome&gt;D:\J2EE\Java\jdk-17&lt;/jdkHome&gt; &lt;/configuration&gt; &lt;/toolchain&gt; &lt;toolchain&gt; &lt;type&gt;jdk&lt;/type&gt; &lt;provides&gt; &lt;version&gt;8&lt;/version&gt; &lt;/provides&gt; &lt;configuration&gt; &lt;jdkHome&gt;D:\J2EE\Java\jdk1.8.0_311&lt;/jdkHome&gt; &lt;/configuration&gt; &lt;/toolchain&gt; &lt;/toolchains&gt; ä¿®æ”¹é¡¹ç›®çš„ pom.xml æ–‡ä»¶ &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;dev&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;false&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-toolchains-plugin&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;toolchain&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;configuration&gt; &lt;toolchains&gt; &lt;jdk&gt; &lt;version&gt;8&lt;/version&gt; &lt;/jdk&gt; &lt;/toolchains&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/profile&gt; &lt;/profiles&gt; ä¿®æ”¹å®Œæˆ‘ä»¬åœ¨ç¼–è¯‘çš„æ—¶å€™åªéœ€è¦è¿è¡Œï¼š mvn clean compile -Pdev å³å¯ï¼Œè¿™æ ·ç¼–è¯‘å°±ä¼šè‡ªåŠ¨ç”¨ jdk8 ä¹Ÿä¸æ˜¯ç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®çš„ï¼Œå½“ç„¶è¿˜æœ‰æ›´ç®€å•çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ pom.xml ä¸­çš„é…ç½®ï¼Œåªéœ€è¦æŠŠï¼š
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-12-25 02:24:23 +0000 +0000'>December 25, 2025</span>&nbsp;Â·&nbsp;<span>3 min</span>&nbsp;Â·&nbsp;<span>522 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to æœ¬åœ°å¼€å‘ä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒç‰ˆæœ¬ JDK çš„è§£å†³æ–¹æ¡ˆ" href="http://localhost:1313/posts/2025-12-25-%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E4%B8%8D%E5%90%8C%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC-jdk-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">MySQL å¤‡ä»½åŠæ¢å¤è„šæœ¬
    </h2>
  </header>
  <div class="entry-content">
    <p>ä½œä¸ºå¼€å‘ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ•°æ®å¤‡ä»½çš„é‡è¦æ€§ï¼Œè€Œæ•°æ®å¤‡ä»½æœ€é‡è¦çš„å°±æ˜¯æ•°æ®åº“å¤‡ä»½ï¼Œå‰ä¸€æ®µæ—¶é—´ç”±äºæ“ä½œå¤±è¯¯ï¼Œè¯¯åˆ è¿‡ä¸€æ¬¡æ•°æ®åº“ï¼Œæ‰€ä»¥ç‰¹æŠŠå¤‡ä»½å’Œæ¢å¤è„šæœ¬åˆ†äº«å‡ºæ¥ï¼Œä½œä¸ºç¬”è®°ã€‚
MySQL å¤‡ä»½è„šæœ¬ #!/bin/bash \# =================================================================== \# MySQL åˆ†åº“å…¨é‡å¤‡ä»½è„šæœ¬ï¼ˆç”Ÿäº§çº§ | è‡ªé€‚åº” &amp;#8211;source-data / &amp;#8211;master-dataï¼‰ \# åŠŸèƒ½ï¼š \# &amp;#8211; è‡ªåŠ¨å‘ç°ç”¨æˆ·æ•°æ®åº“ \# &amp;#8211; æ¯åº“ç‹¬ç«‹å‹ç¼©å¤‡ä»½ \# &amp;#8211; è‡ªåŠ¨é€‰æ‹© &amp;#8211;source-data (8.0&#43;) æˆ– &amp;#8211;master-data (5.7) \# &amp;#8211; æ™ºèƒ½å¤„ç† GTIDï¼ˆä»…åœ¨å¯ç”¨æ—¶è®¾ç½®ï¼‰ \# &amp;#8211; æå– binlog ä½ç½®ç”Ÿæˆ .info æ–‡ä»¶ \# &amp;#8211; æ¸…ç† N å¤©å‰æ—§å¤‡ä»½ \# ä½œè€…ï¼šBridgeLi \# ç‰ˆæœ¬ï¼š1.0 \# =================================================================== \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# é…ç½®åŒº \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- BACKUP_DIR=&#34;/project/backup/mysql/dbs&#34; CNF_FILE=&#34;/project/backup/mysql/my.cnf&#34; RETENTION_DAYS=7 MIN_FREE_SPACE_GB=5 HOSTNAME=$(hostname -s) DT=$(date &#43;%Y-%m-%d_%H%M%S) \# æ’é™¤ç³»ç»Ÿåº“ EXCLUDED_DBS=&#34;^(mysql|sys|information_schema|performance_schema)$&#34; \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# åˆå§‹åŒ– &amp; ä¾èµ–æ£€æŸ¥ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- for cmd in mysql mysqldump gzip gunzip df date awk sed; do command -v &#34;$cmd&#34; &gt;/dev/null || { echo &#34;é”™è¯¯ï¼šç¼ºå°‘å‘½ä»¤ &amp;#8216;$cmd&amp;#8217;&#34;; exit 1; } done mkdir -p &#34;$BACKUP_DIR&#34; || { echo &#34;é”™è¯¯ï¼šæ— æ³•åˆ›å»ºç›®å½• $BACKUP_DIR&#34;; exit 1; } LOG_FILE=&#34;$BACKUP_DIR/backup.log&#34; LOCK_FILE=&#34;$BACKUP_DIR/.backup.lock&#34; if [ -f &#34;$LOCK_FILE&#34; ]; then echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] é”™è¯¯ï¼šé”æ–‡ä»¶å­˜åœ¨ï¼Œå¯èƒ½å·²æœ‰å¤‡ä»½åœ¨è¿è¡Œã€‚&#34; exit 1 fi trap &#34;rm -f &amp;#8216;$LOCK_FILE&amp;#8217;&#34; EXIT touch &#34;$LOCK_FILE&#34; AVAILABLE_GB=$(df -P &#34;$BACKUP_DIR&#34; | tail -1 | awk &amp;#8216;{print int($4/1024/1024)}&amp;#8217;) if [ &#34;$AVAILABLE_GB&#34; -lt &#34;$MIN_FREE_SPACE_GB&#34; ]; then echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] é”™è¯¯ï¼šç£ç›˜ç©ºé—´ä¸è¶³ (${AVAILABLE_GB}GB &lt; ${MIN_FREE_SPACE_GB}GB)&#34; exit 1 fi exec &gt; &gt;(tee -a &#34;$LOG_FILE&#34;) 2&gt;&amp;1 echo &#34;\[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)\] \[$HOSTNAME\] å¼€å§‹å…¨é‡åˆ†åº“å¤‡ä»½&amp;#8230;&#34; \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# æ£€æµ‹ MySQL ç‰ˆæœ¬å’Œ GTID çŠ¶æ€ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- MYSQL_CMD=&#34;mysql &amp;#8211;defaults-extra-file=$CNF_FILE -sN&#34; \# è·å– MySQL ä¸»ç‰ˆæœ¬ï¼ˆ57, 80ï¼‰ MYSQL_VERSION=$($MYSQL_CMD -e &#34;SELECT REPLACE(LEFT(VERSION(), 4), &amp;#8216;.&amp;#8217;, &amp;#8221;);&#34;) if ! [[ &#34;$MYSQL_VERSION&#34; =~ ^[0-9]&#43;$ ]]; then echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] é”™è¯¯ï¼šæ— æ³•è·å– MySQL ç‰ˆæœ¬&#34; exit 1 fi \# é€‰æ‹© source-data / master-data if [ &#34;$MYSQL_VERSION&#34; -ge 80 ]; then REPLICATION_OPT=&#34;&amp;#8211;source-data=2&#34; else REPLICATION_OPT=&#34;&amp;#8211;master-data=2&#34; fi \# æ£€æŸ¥ GTID æ˜¯å¦å¯ç”¨ GTID_MODE=$($MYSQL_CMD -e &#34;SELECT @@GLOBAL.gtid_mode;&#34; 2&gt;/dev/null || echo &#34;OFF&#34;) if [[ &#34;$GTID_MODE&#34; =~ ^(ON|ON_PERMISSIVE|OFF_PERMISSIVE)$ ]]; then GTID_PURGED_OPT=&#34;&amp;#8211;set-gtid-purged=ON&#34; GTID_ENABLED=true else GTID_PURGED_OPT=&#34;&amp;#8211;set-gtid-purged=OFF&#34; GTID_ENABLED=false fi echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] MySQL ç‰ˆæœ¬: $MYSQL_VERSION, ä½¿ç”¨: $REPLICATION_OPT, GTID: ${GTID_MODE:-OFF}&#34; \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# è·å–æ‰€æœ‰éç³»ç»Ÿæ•°æ®åº“ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- dbs=() while IFS= read -r db; do [[ -z &#34;$db&#34; ]] &amp;&amp; continue if [[ ! &#34;$db&#34; =~ $EXCLUDED_DBS ]]; then dbs&#43;=(&#34;$db&#34;) fi done &lt; &lt;($MYSQL_CMD -e &#34;SHOW DATABASES;&#34; 2&gt;&gt;&#34;$LOG_FILE&#34;) if [ ${#dbs[@]} -eq 0 ]; then echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] è­¦å‘Šï¼šæœªæ‰¾åˆ°å¯å¤‡ä»½çš„æ•°æ®åº“ã€‚&#34; exit 0 fi echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] å‘ç° ${#dbs[@]} ä¸ªæ•°æ®åº“: ${dbs[*]}&#34; \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# æ‰§è¡Œå¤‡ä»½ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- SUCCESS_COUNT=0 FAILURE_COUNT=0 START_TIME=$(date &#43;%s) for db in &#34;${dbs[@]}&#34;; do DUMP_FILE=&#34;${db}-${DT}.sql.gz&#34; DUMP_PATH=&#34;$BACKUP_DIR/$DUMP_FILE&#34; INFO_PATH=&#34;${DUMP_PATH%.gz}.info&#34; echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] æ­£åœ¨å¤‡ä»½: $db -&gt; $DUMP_PATH&#34; mysqldump &amp;#8211;defaults-extra-file=&#34;$CNF_FILE&#34; \ &amp;#8211;single-transaction \ &amp;#8211;routines \ &amp;#8211;triggers \ $REPLICATION_OPT \ $GTID_PURGED_OPT \ &amp;#8211;databases &#34;$db&#34; 2&gt;&gt;&#34;$LOG_FILE&#34; | gzip -c &gt; &#34;$DUMP_PATH&#34; if [ $? -eq 0 ] &amp;&amp; [ -s &#34;$DUMP_PATH&#34; ] &amp;&amp; gunzip -t &#34;$DUMP_PATH&#34; &gt;/dev/null 2&gt;&amp;1; then \# æå– binlog ä½ç½®ï¼ˆsource/master å…¼å®¹ï¼‰ read master_file master_pos &lt; &lt;(gzip -dc &#34;$DUMP_PATH&#34; | sed -n &#34;/^&amp;#8211; CHANGE MASTER TO / s/.\*LOG_FILE=&amp;#8217;\\([^&amp;#8217;]\*\\)&amp;#8217;,.\*LOG_POS=\\([0-9]\*\\).*/\\1 \\2/p&#34; | head -1) \# æå– GTIDï¼ˆä»…å½“å¯ç”¨ï¼‰ if [ &#34;$GTID_ENABLED&#34; = true ]; then gtid_purged=$(gzip -dc &#34;$DUMP_PATH&#34; | sed -n &#34;s/^SET @@GLOBAL.GTID_PURGED=&amp;#8217;\\([^&amp;#8217;]*\)&amp;#8217;;\$/\\1/p&#34; | head -1) [ -z &#34;$gtid_purged&#34; ] &amp;&amp; gtid_purged=&#34;NONE&#34; else gtid_purged=&#34;DISABLED&#34; fi \# å†™å…¥ .info { [ -n &#34;$master_file&#34; ] &amp;&amp; echo &#34;File: $master_file&#34; [ -n &#34;$master_pos&#34; ] &amp;&amp; echo &#34;Position: $master_pos&#34; echo &#34;GTID: $gtid_purged&#34; } &gt; &#34;$INFO_PATH&#34; chmod 600 &#34;$DUMP_PATH&#34; &#34;$INFO_PATH&#34; 2&gt;/dev/null || true echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] æˆåŠŸ: $db (binlog: $master_file, pos: $master_pos, gtid: $gtid_purged)&#34; ((SUCCESS_COUNT&#43;&#43;)) else echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] å¤±è´¥: $db&#34; rm -f &#34;$DUMP_PATH&#34; &#34;$INFO_PATH&#34; ((FAILURE_COUNT&#43;&#43;)) fi done \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# æ¸…ç† N å¤©å‰çš„æ—§å¤‡ä»½ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- if [ $FAILURE_COUNT -eq 0 ]; then cleanup_old() { local pattern=&#34;$1&#34; local now_ts=$(date &#43;%s) local files=() mapfile -t files &lt; &lt;(find &#34;$BACKUP_DIR&#34; -name &#34;$pattern&#34; -type f 2&gt;/dev/null) for file in &#34;${files[@]}&#34;; do if [[ &#34;$file&#34; =~ -([0-9]{4})-([0-9]{2})-([0-9]{2})_([0-9]{2})([0-9]{2})([0-9]{2})\. ]]; then \# æå–å„éƒ¨åˆ†ï¼šå¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’ local y=${BASH_REMATCH[1]} local m=${BASH_REMATCH[2]} local d=${BASH_REMATCH[3]} local H=${BASH_REMATCH[4]} local M=${BASH_REMATCH[5]} local S=${BASH_REMATCH[6]} \# æ„é€ åˆæ³•æ—¥æœŸå­—ç¬¦ä¸²ï¼š2025-09-25 02:00:01 local datetime=&#34;$y-$m-$d $H:$M:$S&#34; \# è½¬æ¢ä¸ºæ—¶é—´æˆ³ local file_ts=$(date -d &#34;$datetime&#34; &#43;%s 2&gt;/dev/null) || continue local age_days=$(( (now_ts &amp;#8211; file_ts) / 86400 )) if [ $age_days -ge $RETENTION_DAYS ]; then echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] æ¸…ç†è¿‡æœŸæ–‡ä»¶: $file (å·²å­˜åœ¨ $age_days å¤©)&#34; rm -f &#34;$file&#34; fi fi done } cleanup_old &#34;*.sql.gz&#34; cleanup_old &#34;*.info&#34; END_TIME=$(date &#43;%s) echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] å¤‡ä»½å®Œæˆ: æˆåŠŸ $SUCCESS_COUNTï¼Œå¤±è´¥ $FAILURE_COUNTï¼Œè€—æ—¶ $((END_TIME &amp;#8211; START_TIME)) ç§’&#34; else echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] è­¦å‘Šï¼šæœ‰ $FAILURE_COUNT ä¸ªæ•°æ®åº“å¤‡ä»½å¤±è´¥ï¼Œè·³è¿‡æ¸…ç†ã€‚&#34; exit 1 fi exit 0 MySQL binlog å¤‡ä»½è„šæœ¬ï¼š #!/bin/bash \# =================================================================== \# MySQL Binlog å¢é‡å¤‡ä»½è„šæœ¬ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ \# é…åˆå…¨é‡å¤‡ä»½å®ç° PITR \# ä½œè€…ï¼šBridgeLi \# ç‰ˆæœ¬ï¼š1.0 \# =================================================================== \# é…ç½®å‚æ•° BINLOG_DIR=&#34;/var/lib/mysql&#34; BACKUP_DIR=&#34;/project/backup/mysql/binlogs&#34; CNF_FILE=&#34;/project/backup/mysql/my.cnf&#34; LOG_FILE=&#34;$BACKUP_DIR/binlog_backup.log&#34; LOCK_FILE=&#34;$BACKUP_DIR/.backup.lock&#34; LAST_COPIED_FILE=&#34;$BACKUP_DIR/.last_binlog&#34; \# åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p &#34;$BACKUP_DIR&#34; || { echo &#34;[$(date)] é”™è¯¯ï¼šæ— æ³•åˆ›å»ºå¤‡ä»½ç›®å½• $BACKUP_DIR&#34; &gt;&amp;2; exit 1; } \# ä½¿ç”¨ flock é˜²æ­¢å¹¶å‘æ‰§è¡Œ exec 200&gt;&#34;$LOCK_FILE&#34; if ! flock -n 200; then echo &#34;[$(date)] é”™è¯¯ï¼šå¤‡ä»½è„šæœ¬å·²åœ¨è¿è¡Œï¼Œé€€å‡ºã€‚&#34; | tee -a &#34;$LOG_FILE&#34; exit 1 fi \# é‡å®šå‘æ‰€æœ‰è¾“å‡ºåˆ°æ—¥å¿— exec &gt;&gt; &#34;$LOG_FILE&#34; 2&gt;&amp;1 echo &#34;==================================&#34; echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] å¼€å§‹ binlog å¢é‡å¤‡ä»½&amp;#8230;&#34; \# è·å–å½“å‰æ´»è·ƒ binlog CURRENT_LOG=$(mysql &amp;#8211;defaults-extra-file=&#34;$CNF_FILE&#34; -sN -e &#34;SHOW MASTER STATUS;&#34; 2&gt;/dev/null | awk &amp;#8216;{print $1}&amp;#8217;) if [ -z &#34;$CURRENT_LOG&#34; ]; then echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] é”™è¯¯ï¼šæ— æ³•è·å–å½“å‰ binlog åç§°ï¼Œè¯·æ£€æŸ¥ MySQL è¿æ¥æˆ–æƒé™ã€‚&#34; exit 1 fi echo &#34;å½“å‰æ´»è·ƒ binlog: $CURRENT_LOG&#34; \# è¯»å–ä¸Šæ¬¡å¤‡ä»½çš„ binlog if [[ -f &#34;$LAST_COPIED_FILE&#34; ]]; then LAST_LOG=$(cat &#34;$LAST_COPIED_FILE&#34;) echo &#34;ä¸Šæ¬¡å·²å¤‡ä»½è‡³: $LAST_LOG&#34; else LAST_LOG=&#34;&#34; echo &#34;é¦–æ¬¡è¿è¡Œï¼Œå°†å¤‡ä»½æ‰€æœ‰å†å² binlogï¼ˆé™¤å½“å‰å¤–ï¼‰ã€‚&#34; fi COPIED=0 cd &#34;$BINLOG_DIR&#34; || { echo &#34;æ— æ³•è¿›å…¥ binlog ç›®å½•: $BINLOG_DIR&#34;; exit 1; } \# è·å–æ‰€æœ‰ binlog æ–‡ä»¶å¹¶æŒ‰ç‰ˆæœ¬æ’åº mapfile -t LOGS &lt; &lt;(find . -maxdepth 1 -name &amp;#8216;mysql-bin.*&amp;#8217; -type f -printf &amp;#8216;%f\n&amp;#8217; | sort -V) for log in &#34;${LOGS[@]}&#34;; do [[ ! -f &#34;$log&#34; ]] &amp;&amp; continue \# è·³è¿‡å½“å‰æ´»è·ƒçš„ binlog [[ &#34;$log&#34; == &#34;$CURRENT_LOG&#34; ]] &amp;&amp; continue \# åˆ¤æ–­æ˜¯å¦éœ€è¦å¤‡ä»½ï¼šlog &gt; LAST_LOGï¼ˆç‰ˆæœ¬æ’åºï¼‰ if [[ -n &#34;$LAST_LOG&#34; ]]; then \# ä½¿ç”¨ sort -V åˆ¤æ–­é¡ºåº greater=$(printf &amp;#8216;%s\n%s&amp;#8217; &#34;$LAST_LOG&#34; &#34;$log&#34; | sort -V | tail -1) if [[ &#34;$greater&#34; != &#34;$log&#34; || &#34;$log&#34; == &#34;$LAST_LOG&#34; ]]; then continue fi fi \# æ‰§è¡Œå‹ç¼©å¤‡ä»½ if gzip -c &#34;$log&#34; &gt; &#34;$BACKUP_DIR/${log}.gz&#34;; then echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] å·²å‹ç¼©å¤‡ä»½: $log&#34; ((COPIED&#43;&#43;)) else echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] é”™è¯¯ï¼šå¤‡ä»½å¤±è´¥ $log&#34; fi done \# åŸå­æ›´æ–°æœ€åå¤‡ä»½çš„ binlog echo &#34;$CURRENT_LOG&#34; &gt; &#34;${LAST_COPIED_FILE}.tmp&#34; &amp;&amp; mv &#34;${LAST_COPIED_FILE}.tmp&#34; &#34;$LAST_COPIED_FILE&#34; echo &#34;[$(date &#43;&amp;#8217;%Y-%m-%d %H:%M:%S&amp;#8217;)] binlog å¢é‡å¤‡ä»½å®Œæˆï¼Œå…±å¤åˆ¶ $COPIED ä¸ªæ–‡ä»¶ã€‚&#34; echo &#34;==================================&#34; MySQL å¥åº·æ£€æŸ¥è„šæœ¬ï¼ˆéå¿…éœ€ï¼Œåªéœ€è¦å¤‡ä»½å°±è¡Œï¼‰ #!/bin/bash \# =================================================================== \# MySQL å¤‡ä»½å¥åº·æ£€æŸ¥è„šæœ¬ï¼ˆä¼˜åŒ–ç”Ÿäº§ç‰ˆ &amp;#8211; å·²ä¿®å¤ï¼‰ \# åŠŸèƒ½ï¼šæ£€æŸ¥æœ€è¿‘å¤‡ä»½æ—¶æ•ˆã€ç£ç›˜ä½¿ç”¨ç‡ï¼Œè®°å½•æ—¥å¿—ï¼Œå‘é€å‘Šè­¦ï¼Œè¾“å‡º Prometheus æŒ‡æ ‡ \# ä½œè€…ï¼šBridgeLi \# ç‰ˆæœ¬ï¼š1.0 \# =================================================================== \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# é…ç½®å‚æ•° \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- BACKUP_DIR=&#34;/project/backup/mysql/dbs&#34; LOG_DIR=&#34;/var/log/mysql&#34; LOG_FILE=&#34;$LOG_DIR/health_check.log&#34; ALERT_EMAIL=&#34;admin@example.com&#34; HOSTNAME=$(hostname -s) \# Prometheus æŒ‡æ ‡è¾“å‡ºè·¯å¾„ PROM_FILE=&#34;/tmp/backup_health.prom&#34; PROM_TMP_FILE=&#34;/tmp/backup_health.prom.tmp&#34; \# å‘Šè­¦é˜ˆå€¼ï¼ˆå°æ—¶ï¼‰ MAX_BACKUP_AGE_HOURS=26 DISK_WARN_THRESHOLD=80 DISK_CRIT_THRESHOLD=90 \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# åˆ›å»ºæ—¥å¿—ç›®å½•ï¼ˆé¿å… tee æŠ¥é”™ï¼‰ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- if [ ! -d &#34;$LOG_DIR&#34; ]; then mkdir -p &#34;$LOG_DIR&#34; &amp;&amp; chmod 755 &#34;$LOG_DIR&#34; [ $? -ne 0 ] &amp;&amp; echo &#34;ERROR: Cannot create log directory $LOG_DIR&#34; &amp;&amp; exit 1 fi \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# é‡å®šå‘è¾“å‡ºï¼šåŒæ—¶è¾“å‡ºåˆ°æ—¥å¿—å’Œç»ˆç«¯ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- exec &gt; &gt;(tee -a &#34;$LOG_FILE&#34;) 2&gt;&amp;1 \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# æ£€æŸ¥æœ€è¿‘ä¸€æ¬¡å¤‡ä»½æ˜¯å¦åœ¨åˆç†æ—¶é—´å†… \# è¾“å‡ºï¼šçŠ¶æ€ä¿¡æ¯ \# è¿”å›å€¼ï¼š \# 0 = OK \# 1 = CRITICALï¼ˆè¶…æ—¶ï¼‰ \# 2 = ERRORï¼ˆæ— å¤‡ä»½ï¼‰ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- check_last_backup() { local latest_entry=$(find &#34;$BACKUP_DIR&#34; -name &#34;*.sql.gz&#34; -type f -printf &amp;#8216;%T@ %p\n&amp;#8217; 2&gt;/dev/null | sort -n | tail -1) if [ -z &#34;$latest_entry&#34; ]; then echo &#34;ERROR no_recent_backup&#34; return 2 fi \# æå–æ—¶é—´æˆ³ï¼ˆå–æ•´æ•°éƒ¨åˆ†ï¼‰ local mtime_epoch=$(echo &#34;$latest_entry&#34; | awk &amp;#8216;{split($1,a,&#34;.&#34;); print a[1]}&amp;#8217;) local now_epoch=$(date &#43;%s) local age_seconds=$((now_epoch &amp;#8211; mtime_epoch)) local age_hours=$((age_seconds / 3600)) if [ $age_hours -gt $MAX_BACKUP_AGE_HOURS ]; then echo &#34;CRITICAL backup_too_old $age_hours hours&#34; return 1 else echo &#34;OK last_backup $age_hours hours ago&#34; return 0 fi } \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# æ£€æŸ¥å¤‡ä»½ç›®å½•æ‰€åœ¨ç£ç›˜ä½¿ç”¨ç‡ \# è¿”å›å€¼ï¼š \# 0 = OK (&lt;80%) \# 1 = CRITICAL (&gt;90%) \# 2 = WARN (80%~90%) \# è¾“å‡ºï¼šçŠ¶æ€ä¿¡æ¯ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- check_disk_usage() { if [ ! -d &#34;$BACKUP_DIR&#34; ]; then echo &#34;ERROR backup_dir_not_found: $BACKUP_DIR&#34; return 1 fi local df_out=$(df -P &#34;$BACKUP_DIR&#34; 2&gt;/dev/null) if [ -z &#34;$df_out&#34; ]; then echo &#34;ERROR disk_check_failed&#34; return 1 fi local used_percent=$(echo &#34;$df_out&#34; | tail -1 | awk &amp;#8216;{print $5}&amp;#8217; | tr -d &amp;#8216;%&amp;#8217;) if ! [[ &#34;$used_percent&#34; =~ ^[0-9]&#43;$ ]]; then echo &#34;ERROR disk_usage_invalid: $used_percent&#34; return 1 fi if [ $used_percent -gt $DISK_CRIT_THRESHOLD ]; then echo &#34;CRITICAL disk_usage ${used_percent}%&#34; return 1 elif [ $used_percent -gt $DISK_WARN_THRESHOLD ]; then echo &#34;WARN disk_usage ${used_percent}%&#34; return 2 else echo &#34;OK disk_usage ${used_percent}%&#34; return 0 fi } \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# å‘é€å‘Šè­¦é‚®ä»¶ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- send_alert() { local subject=&#34;$1&#34; local body=&#34;$2&#34; if command -v mail &gt;/dev/null 2&gt;&amp;1; then echo -e &#34;$body&#34; | mail -s &#34;$subject&#34; &#34;$ALERT_EMAIL&#34; echo &#34;Alert sent to $ALERT_EMAIL&#34; else echo &#34;WARNING: &amp;#8216;mail&amp;#8217; command not available. Skipping alert.&#34; logger &#34;MySQL Backup Alert: $subject | $body&#34; fi } \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# ä¸»é€»è¾‘å¼€å§‹ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- echo &#34;=== Backup Health Check ($(date)) on $HOSTNAME ===&#34; \# æ‰§è¡Œæ£€æŸ¥ï¼Œæ•è·è¾“å‡ºå’Œè¿”å›å€¼ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼ï¼‰ output1=$(check_last_backup) res1=$? echo &#34;$output1&#34; output2=$(check_disk_usage) res2=$? echo &#34;$output2&#34; \# åˆ¤æ–­æ˜¯å¦éœ€è¦å‘Šè­¦ alert_needed=false if [ $res1 -eq 1 ] || [ $res1 -eq 2 ] || [ $res2 -eq 1 ]; then alert_needed=true fi \# å‘é€å‘Šè­¦ if [ &#34;$alert_needed&#34; = true ]; then subject=&#34;âš ï¸ MySQL å¤‡ä»½å¼‚å¸¸ &amp;#8211; $HOSTNAME&#34; body=&#34;ã€å¤‡ä»½çŠ¶æ€ã€‘$output1\nã€ç£ç›˜çŠ¶æ€ã€‘$output2\n\nè¯·ç«‹å³æ£€æŸ¥å¤‡ä»½ç›®å½•ï¼š$BACKUP_DIR&#34; send_alert &#34;$subject&#34; &#34;$body&#34; else echo &#34;All checks OK.&#34; fi \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# è¾“å‡º Prometheus æŒ‡æ ‡ï¼ˆåŸå­å†™å…¥ï¼‰ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- ( echo &#34;# HELP mysql_backup_last_success_age_hours Age of last successful backup in hours, -1 if none&#34; echo &#34;# TYPE mysql_backup_last_success_age_hours gauge&#34; local latest_entry=$(find &#34;$BACKUP_DIR&#34; -name &#34;*.sql.gz&#34; -type f -printf &amp;#8216;%T@ %p\n&amp;#8217; 2&gt;/dev/null | sort -n | tail -1) if [ -z &#34;$latest_entry&#34; ]; then echo &#34;mysql_backup_last_success_age_hours -1&#34; else local mtime_epoch=$(echo &#34;$latest_entry&#34; | awk &amp;#8216;{split($1,a,&#34;.&#34;); print a[1]}&amp;#8217;) local now=$(date &#43;%s) local age_hours=$(( (now &amp;#8211; mtime_epoch) / 3600 )) echo &#34;mysql_backup_last_success_age_hours $age_hours&#34; fi echo &#34;&#34; echo &#34;# HELP mysql_backup_disk_usage_percent Disk usage of the backup partition (%)&#34; echo &#34;# TYPE mysql_backup_disk_usage_percent gauge&#34; df -P &#34;$BACKUP_DIR&#34; 2&gt;/dev/null | tail -1 | awk &amp;#8216;{gsub(/%/,&#34;&#34;,$5); print &#34;mysql_backup_disk_usage_percent&#34;, $5}&amp;#8217; ) &gt; &#34;$PROM_TMP_FILE&#34; &amp;&amp; mv &#34;$PROM_TMP_FILE&#34; &#34;$PROM_FILE&#34; if [ $? -eq 0 ]; then echo &#34;Prometheus metrics written to $PROM_FILE&#34; else echo &#34;ERROR: Failed to write Prometheus metrics&#34; fi echo &#34;=== Check completed ===&#34; MySQL æ¢å¤è„šæœ¬ #!/bin/bash \# =================================================================== \# MySQL Point-in-Time Recovery (PITR) è„šæœ¬ \# åŠŸèƒ½ï¼šåŸºäºå…¨é‡å¤‡ä»½ &#43; binlog æ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹ \# ä½œè€…ï¼šBridgeLi \# ç‰ˆæœ¬ï¼š1.0 # \# ç”¨æ³•ï¼š \# ./mysql-pitr-restore.sh &#34;2025-09-24 10:00:00&#34; [æ•°æ®åº“å] \# ./mysql-pitr-restore.sh &amp;#8211;dry-run &#34;2025-09-24 10:00:00&#34; [db_name] \# ./mysql-pitr-restore.sh &amp;#8211;help # \# ä¾èµ–ï¼š \# mysql, mysqlbinlog, gzip, find, sort \# =================================================================== set -euo pipefail # ä¸¥æ ¼æ¨¡å¼ï¼šå‡ºé”™å³é€€å‡º \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# é»˜è®¤é…ç½® \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- BACKUP_DIR=&#34;/project/backup/mysql/dbs&#34; BINLOG_DIR=&#34;/project/backup/mysql/binlogs&#34; RESTORE_DIR=&#34;/tmp/mysql_restore_$$&#34; # ä½¿ç”¨ PID é¿å…å†²çª CNF_FILE=&#34;/project/backup/mysql/my.cnf&#34; LOG_FILE=&#34;$BACKUP_DIR/restore.log&#34; DRY_RUN=0 DEBUG=0 TARGET_TIME=&#34;&#34; TARGET_DB=&#34;&#34; \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# å‡½æ•°å®šä¹‰ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- usage() { cat &lt;&lt; &amp;#8216;EOF&amp;#8217; ç”¨æ³•: ./mysql-pitr-restore.sh [é€‰é¡¹] &lt;ç›®æ ‡æ—¶é—´ &amp;#8216;YYYY-MM-DD HH:MM:SS&amp;#8217;&gt; [æ•°æ®åº“å] é€‰é¡¹: &amp;#8211;dry-run æ¨¡æ‹Ÿæ‰§è¡Œï¼Œä¸çœŸæ­£æ¢å¤æ•°æ® &amp;#8211;debug å¯ç”¨è°ƒè¯•è¾“å‡º &amp;#8211;help æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯ ç¤ºä¾‹: ./mysql-pitr-restore.sh &#34;2025-09-24 10:00:00&#34; ./mysql-pitr-restore.sh &amp;#8211;dry-run &#34;2025-09-24 10:00:00&#34; mydb ./mysql-pitr-restore.sh &amp;#8211;debug &#34;2025-09-24 12:30:00&#34; æ³¨æ„: &amp;#8211; å…¨é‡å¤‡ä»½æ–‡ä»¶éœ€åŒ…å« CHANGE MASTER TO è¯­å¥ä»¥æå– binlog ä½ç½® &amp;#8211; binlog æ–‡ä»¶éœ€ä¸º .gz å‹ç¼©æ ¼å¼ï¼Œå‘½åå¦‚ mysql-bin.000001.gz &amp;#8211; æ¢å¤å‰è¯·ç¡®ä¿æ•°æ®åº“æ— å†™å…¥æ“ä½œï¼ EOF } log() { local level=&#34;${1}&#34; shift echo &#34;\[$(date &amp;#8216;&#43;%F %T&amp;#8217;)\] \[$level\] $*&#34; | tee -a &#34;$LOG_FILE&#34; } debug() { [[ $DEBUG -eq 1 ]] &amp;&amp; log &#34;DEBUG&#34; &#34;$@&#34; } cleanup() { if [[ -d &#34;$RESTORE_DIR&#34; ]]; then debug &#34;æ­£åœ¨æ¸…ç†ä¸´æ—¶ç›®å½•: $RESTORE_DIR&#34; rm -rf &#34;$RESTORE_DIR&#34; fi } trap cleanup EXIT confirm_proceed() { log &#34;WARN&#34; &#34;å³å°†å¼€å§‹æ¢å¤è‡³æ—¶é—´ç‚¹: $TARGET_TIME&#34; if [[ -n &#34;$TARGET_DB&#34; ]]; then log &#34;INFO&#34; &#34;ä»…æ¢å¤æ•°æ®åº“: $TARGET_DB&#34; fi log &#34;WARN&#34; &#34;è¯·ç¡®ä¿ MySQL å½“å‰æ— å†™å…¥æ“ä½œï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼&#34; read -p &#34;ç¡®å®šç»§ç»­ï¼Ÿ[y/N]: &#34; -n 1 -r echo if [[ ! $REPLY =~ ^[Yy]$ ]]; then log &#34;INFO&#34; &#34;ç”¨æˆ·å–æ¶ˆæ“ä½œ&#34; exit 1 fi } find_latest_full_backup() { local latest_file=&#34;&#34; local latest_time=&#34;&#34; local file time_str backup_time for file in &#34;$BACKUP_DIR&#34;/*.sql{,.gz}; do [[ -f &#34;$file&#34; ]] || continue \# æå–æ—¶é—´æˆ³ï¼šåŒ¹é… -YYYY-MM-DD_HHMMSS.sql æˆ– .sql.gz if [[ &#34;$file&#34; =~ -([0-9]{4}-[0-9]{2}-[0-9]{2}_[0-9]{6})\.sql(\.gz)?$ ]]; then time_str=&#34;${BASH_REMATCH[1]}&#34; backup_time=&#34;${time_str:0:10} ${time_str:11:2}:${time_str:13:2}:${time_str:15:2}&#34; debug &#34;å‘ç°å¤‡ä»½: $file -&gt; æ—¶é—´: $backup_time&#34; if [[ &#34;$backup_time&#34; &lt; &#34;$TARGET_TIME&#34; ]]; then if [[ -z &#34;$latest_time&#34; || &#34;$backup_time&#34; &gt; &#34;$latest_time&#34; ]]; then latest_file=&#34;$file&#34; latest_time=&#34;$backup_time&#34; fi fi else debug &#34;è·³è¿‡ä¸åŒ¹é…çš„æ–‡ä»¶: $file&#34; fi done if [[ -z &#34;$latest_file&#34; ]]; then log &#34;ERROR&#34; &#34;æœªæ‰¾åˆ°æ—©äº $TARGET_TIME çš„å…¨é‡å¤‡ä»½&#34; return 1 fi echo &#34;$latest_file|$latest_time&#34; } extract_binlog_position() { local backup_file=&#34;$1&#34; local content_cmd=&#34;gzip -dc&#34; # é»˜è®¤æ˜¯ .gz [[ &#34;$backup_file&#34; == *.sql ]] &amp;&amp; content_cmd=&#34;cat&#34; local line line=$(eval &#34;$content_cmd&#34; &#34;$backup_file&#34; | sed -n &#34;s/.\*CHANGE MASTER TO MASTER_LOG_FILE=&amp;#8217;\([^&amp;#8217;]\*\)&amp;#8217;,.\*, MASTER_LOG_POS=\([0-9]\*\).*/\1 \2/p&#34; | head -1) if [[ -z &#34;$line&#34; ]]; then log &#34;ERROR&#34; &#34;æ— æ³•ä»å¤‡ä»½ä¸­æå– binlog ä½ç½®ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¯ç”¨ &amp;#8211;master-data=2&#34; return 1 fi echo &#34;$line&#34; } \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# å‚æ•°è§£æ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- while [[ $# -gt 0 ]]; do case $1 in &amp;#8211;dry-run) DRY_RUN=1 shift ;; &amp;#8211;debug) DEBUG=1 shift ;; &amp;#8211;help) usage exit 0 ;; -*) log &#34;ERROR&#34; &#34;æœªçŸ¥é€‰é¡¹: $1&#34; usage exit 1 ;; *) break ;; esac done if [[ $# -lt 1 ]]; then log &#34;ERROR&#34; &#34;ç¼ºå°‘ç›®æ ‡æ—¶é—´å‚æ•°&#34; usage exit 1 fi TARGET_TIME=&#34;$1&#34; if [[ ! &#34;$TARGET_TIME&#34; =~ ^[0-9]{4}-[0-9]{2}-[0-9]{2}\ [0-9]{2}:[0-9]{2}:[0-9]{2}$ ]]; then log &#34;ERROR&#34; &#34;æ—¶é—´æ ¼å¼æ— æ•ˆï¼Œåº”ä¸º &amp;#8216;YYYY-MM-DD HH:MM:SS&amp;#8217;&#34; exit 1 fi TARGET_DB=&#34;${2:-}&#34; \# è®¾ç½®æ—¥å¿—è¾“å‡º exec &gt; &gt;(tee -a &#34;$LOG_FILE&#34;) 2&gt;&amp;1 \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- \# ä¸»æµç¨‹ \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- log &#34;INFO&#34; &#34;å¼€å§‹ PITR æ¢å¤æµç¨‹ï¼Œç›®æ ‡æ—¶é—´: $TARGET_TIME&#34; if (( DRY_RUN )); then log &#34;DRYRUN&#34; &#34;è¿è¡Œåœ¨æ¨¡æ‹Ÿæ¨¡å¼ (&amp;#8211;dry-run)ï¼Œä¸ä¼šæ‰§è¡Œå®é™…æ¢å¤&#34; fi \# 1. æŸ¥æ‰¾æœ€æ¥è¿‘çš„å…¨é‡å¤‡ä»½ log &#34;INFO&#34; &#34;æ­£åœ¨æŸ¥æ‰¾æœ€æ¥è¿‘ä¸”æ—©äº $TARGET_TIME çš„å…¨é‡å¤‡ä»½&amp;#8230;&#34; result=$(find_latest_full_backup) if [[ $? -ne 0 ]]; then exit 1 fi FULL_BACKUP=$(echo &#34;$result&#34; | cut -d&amp;#8217;|&amp;#8217; -f1) FULL_TIME=$(echo &#34;$result&#34; | cut -d&amp;#8217;|&amp;#8217; -f2) log &#34;INFO&#34; &#34;ä½¿ç”¨å…¨é‡å¤‡ä»½: $FULL_BACKUP (æ—¶é—´: $FULL_TIME)&#34; \# 2. ç”¨æˆ·ç¡®è®¤ if (( !DRY_RUN )); then confirm_proceed fi \# 3. æ¢å¤å…¨é‡æ•°æ® log &#34;INFO&#34; &#34;å¼€å§‹å¯¼å…¥å…¨é‡æ•°æ®&amp;#8230;&#34; if (( DRY_RUN )); then log &#34;DRYRUN&#34; &#34;å°†å¯¼å…¥: $FULL_BACKUP&#34; else mkdir -p &#34;$RESTORE_DIR&#34; if [[ &#34;$FULL_BACKUP&#34; == *.gz ]]; then if gzip -dc &#34;$FULL_BACKUP&#34; | mysql &amp;#8211;defaults-extra-file=&#34;$CNF_FILE&#34;; then log &#34;INFO&#34; &#34;å…¨é‡æ¢å¤æˆåŠŸ&#34; else log &#34;ERROR&#34; &#34;å…¨é‡å¯¼å…¥å¤±è´¥&#34; exit 1 fi else if mysql &amp;#8211;defaults-extra-file=&#34;$CNF_FILE&#34; &lt; &#34;$FULL_BACKUP&#34;; then log &#34;INFO&#34; &#34;å…¨é‡æ¢å¤æˆåŠŸ&#34; else log &#34;ERROR&#34; &#34;å…¨é‡å¯¼å…¥å¤±è´¥&#34; exit 1 fi fi fi \# 4. æå– binlog èµ·å§‹ä½ç½® log &#34;INFO&#34; &#34;æå– binlog èµ·å§‹ä½ç½®&amp;#8230;&#34; position_line=$(extract_binlog_position &#34;$FULL_BACKUP&#34;) if [[ $? -ne 0 ]]; then exit 1 fi read -r START_FILE START_POS &lt;&lt;&lt; &#34;$position_line&#34; log &#34;INFO&#34; &#34;ä» binlog å¼€å§‹åº”ç”¨: $START_FILE, ä½ç½®: $START_POS&#34; \# 5. åº”ç”¨ binlog åˆ°ç›®æ ‡æ—¶é—´ log &#34;INFO&#34; &#34;å¼€å§‹åº”ç”¨ binlog å¢é‡æ—¥å¿—&amp;#8230;&#34; applied=0 for binlog_gz in $(find &#34;$BINLOG_DIR&#34; -name &#34;*.gz&#34; | sort); do local binlog_base binlog_base=$(basename &#34;$binlog_gz&#34; .gz) \# è·³è¿‡æ—©äºèµ·å§‹æ–‡ä»¶çš„æ—¥å¿— if [[ &#34;$binlog_base&#34; &lt; &#34;$START_FILE&#34; ]]; then continue fi log &#34;INFO&#34; &#34;å¤„ç† binlog: $binlog_base&#34; \# è§£å‹åˆ°ä¸´æ—¶ç›®å½• mkdir -p &#34;$RESTORE_DIR/binlogs&#34; local tmp_binlog=&#34;$RESTORE_DIR/binlogs/$binlog_base&#34; if (( DRY_RUN )); then log &#34;DRYRUN&#34; &#34;å°†è§£å‹å¹¶åº”ç”¨: $binlog_gz -&gt; $tmp_binlog&#34; applied=1 continue fi gzip -dc &#34;$binlog_gz&#34; &gt; &#34;$tmp_binlog&#34; \# æ„å»º mysqlbinlog å‘½ä»¤ local mysqlbinlog_cmd=( mysqlbinlog &amp;#8211;start-position=&#34;$START_POS&#34; &amp;#8211;stop-datetime=&#34;$TARGET_TIME&#34; &#34;${TARGET_DB:&#43;&amp;#8211;database=$TARGET_DB}&#34; &#34;$tmp_binlog&#34; ) local mysql_cmd=(mysql &amp;#8211;defaults-extra-file=&#34;$CNF_FILE&#34;) debug &#34;æ‰§è¡Œå‘½ä»¤: ${mysqlbinlog_cmd[\*]} | ${mysql_cmd[\*]}&#34; if &#34;${mysqlbinlog_cmd[@]}&#34; | &#34;${mysql_cmd[@]}&#34;; then log &#34;INFO&#34; &#34;æˆåŠŸåº”ç”¨ binlog: $binlog_base&#34; applied=1 else local ret=$? log &#34;INFO&#34; &#34;å®Œæˆ binlog åº”ç”¨ï¼ˆå¯èƒ½å·²åˆ°è¾¾ç›®æ ‡æ—¶é—´æˆ–ä¸­æ–­ï¼‰ï¼Œè¿”å›ç : $ret&#34; applied=1 break # å…³é”®ï¼šä¸å†å¤„ç†åç»­ binlog fi rm -f &#34;$tmp_binlog&#34; START_POS=4 # ä¸‹ä¸€ä¸ªæ–‡ä»¶ä»äº‹ä»¶å¤´åå¼€å§‹ done \# 6. ç»“æœæ±‡æŠ¥ if (( applied == 0 )); then log &#34;WARN&#34; &#34;æœªåº”ç”¨ä»»ä½• binlogï¼Œè¯·æ£€æŸ¥ binlog æ˜¯å¦å­˜åœ¨ã€æ—¶é—´èŒƒå›´æ˜¯å¦åˆç†&#34; fi if (( DRY_RUN )); then log &#34;DRYRUN&#34; &#34;æ¨¡æ‹Ÿæ‰§è¡Œç»“æŸã€‚çœŸå®æ¢å¤è¯·ç§»é™¤ &amp;#8211;dry-run å‚æ•°ã€‚&#34; else log &#34;INFO&#34; &#34;æ¢å¤å®Œæˆï¼šå·²æ¢å¤è‡³ $TARGET_TIME&#34; log &#34;INFO&#34; &#34;è¯·ç«‹å³éªŒè¯æ•°æ®ä¸€è‡´æ€§ï¼Œå¹¶æ£€æŸ¥å…³é”®ä¸šåŠ¡é€»è¾‘ã€‚&#34; fi exit 0 my.cnf æ–‡ä»¶ï¼ˆ600 æƒé™ï¼‰ [client] user=ç”¨æˆ·å password=å¯†ç  host=localhost port=3306 crontab è¡¨è¾¾å¼ \# æ¯å¤© 2:00 å…¨é‡å¤‡ä»½ 0 2 \* \* * /project/backup/mysql/backup_per_db.sh \# æ¯å°æ—¶ 0 åˆ† å¢é‡ binlog 0 \* \* \* \* /project/backup/mysql/backup_binlog.sh \# æ¯å¤© 3:10 å¥åº·æ£€æŸ¥ 10 3 \* \* * /project/backup/mysql/check_backup_health.sh å¦‚æœæŠ¥ï¼šbash: ./backup_per_db.sh: /bin/bash^M: åçš„è§£é‡Šå™¨: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œè§£å†³æ–¹æ¡ˆï¼š ä½¿ç”¨ vim ç¼–è¾‘å™¨ vim backup_per_db.sh åœ¨å‘½ä»¤æ¨¡å¼ä¸‹æ‰§è¡Œï¼š :set fileformat=unix :wq </p>
  </div>
  <footer class="entry-footer"><span title='2025-10-23 09:51:35 +0000 +0000'>October 23, 2025</span>&nbsp;Â·&nbsp;<span>11 min</span>&nbsp;Â·&nbsp;<span>2332 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to MySQL å¤‡ä»½åŠæ¢å¤è„šæœ¬" href="http://localhost:1313/posts/2025-10-23-mysql-%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D%E8%84%9A%E6%9C%AC/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">ä½¿ç”¨ docker ä¸€é”®éƒ¨ç½² ELK(åŒ…å«ä¸­æ–‡åˆ†è¯) æœåŠ¡è„šæœ¬
    </h2>
  </header>
  <div class="entry-content">
    <p>å‰å‡ å¤©å…¬å¸æœ‰ä¸ªéœ€æ±‚è¦åšå…¨æ–‡ç´¢å¼•ï¼Œäºæ˜¯å†™äº†ä¸€ä¸ªè„šæœ¬ä½¿ç”¨ docker ä¸€é”®éƒ¨ç½² ELK æœåŠ¡ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
#!/bin/bash set -e echo &#34;==================================================&#34; echo &#34;ğŸš€ å¼€å§‹éƒ¨ç½² ELK &#43; MySQL åŒæ­¥ï¼ˆä¸­æ–‡åˆ†è¯ &#43; å›ºå®šç´¢å¼•ï¼‰&#34; echo &#34;==================================================&#34; \# ==================== é…ç½®åŒºï¼ˆè¯·ä¿®æ”¹ï¼‰==================== MYSQL_HOST=&#34;192.168.124.6&#34; # âœï¸ ä¿®æ”¹ä¸ºä½ çš„ MySQL IP MYSQL_USER=&#34;root&#34; # è¯»å–æƒé™ç”¨æˆ· MYSQL_PASSWORD=&#34;123456&#34; # ç”¨æˆ·å¯†ç  MYSQL_DB=&#34;ams&#34; # æ•°æ®åº“å ELASTIC_PASSWORD=&#34;i*B4j6eD&#43;g0e&#34; # ES å¯†ç ï¼ˆè‡³å°‘ 8 ä½ï¼Œå«å¤§å°å†™&#43;æ•°å­—ï¼‰ ES_VERSION=&#34;8.11.3&#34; # å¿…é¡»ä¸ IK æ’ä»¶ç‰ˆæœ¬ä¸€è‡´ LOGSTASH_VERSION=&#34;8.11.3&#34; \# ======================================================== \# é¡¹ç›®è·¯å¾„ ROOT_DIR=&#34;/project/elastic-sync&#34; mkdir -p &#34;$ROOT_DIR&#34; cd &#34;$ROOT_DIR&#34; echo &#34;ğŸ“ åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„&#34; mkdir -p config/mysql config data/es data/kibana logs/logstash plugins/ik \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- ä¸‹è½½ IK åˆ†è¯æ’ä»¶ &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212; IK_URL=&#34;https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-ik-${ES_VERSION}.zip&#34; IK_DIR=&#34;$ROOT_DIR/plugins/ik&#34; if [ ! -f &#34;$IK_DIR/plugin-descriptor.properties&#34; ]; then echo &#34;ğŸ“¥ æ­£åœ¨ä¸‹è½½ IK åˆ†è¯æ’ä»¶ v${ES_VERSION}&amp;#8230;&#34; wget -q &#34;$IK_URL&#34; -O /tmp/ik.zip unzip -q /tmp/ik.zip -d &#34;$IK_DIR&#34; rm /tmp/ik.zip chown -R 1000:1000 &#34;$IK_DIR&#34; echo &#34;âœ… IK æ’ä»¶å®‰è£…å®Œæˆ&#34; else echo &#34;â„¹ï¸ IK æ’ä»¶å·²å­˜åœ¨ï¼Œè·³è¿‡å®‰è£…&#34; fi \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- ç”Ÿæˆ elasticsearch.yml &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- cat &gt; config/elasticsearch.yml &lt;&lt; EOF cluster.name: production-cluster node.name: node-1 node.roles: [ data, master, ingest ] path: data: /usr/share/elasticsearch/data logs: /usr/share/elasticsearch/logs network.host: 0.0.0.0 http.port: 9200 http.cors.enabled: true http.cors.allow-origin: &#34;*&#34; discovery.type: single-node xpack.security.enabled: true xpack.security.http.ssl.enabled: false xpack.monitoring.collection.enabled: true EOF \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- ç”Ÿæˆ logstash.yml &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- cat &gt; config/logstash.yml &lt;&lt; EOF http.host: &#34;0.0.0.0&#34; xpack.monitoring.enabled: false config.reload.automatic: false EOF \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- ç”Ÿæˆ logstash.conf &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- cat &gt; config/logstash.conf &lt;&lt; EOF input { jdbc { jdbc_connection_string =&gt; &#34;jdbc:mysql://$MYSQL_HOST:3306/$MYSQL_DB?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&#34; jdbc_user =&gt; &#34;$MYSQL_USER&#34; jdbc_password =&gt; &#34;$MYSQL_PASSWORD&#34; jdbc_driver_library =&gt; &#34;/usr/share/logstash/mysql/mysql-connector-java-8.0.30.jar&#34; jdbc_driver_class =&gt; &#34;com.mysql.cj.jdbc.Driver&#34; jdbc_default_timezone =&gt; &#34;Asia/Shanghai&#34; statement =&gt; &#34; SELECT * FROM article WHERE updated_at &gt;= :sql_last_value ORDER BY updated_at ASC &#34; use_column_value =&gt; true tracking_column =&gt; &#34;updated_at&#34; tracking_column_type =&gt; &#34;timestamp&#34; last_run_metadata_path =&gt; &#34;/usr/share/logstash/.logstash_jdbc_last_run&#34; schedule =&gt; &#34;\*/2 \* \* \* *&#34; } } filter { \# æ¸…æ´— content å­—æ®µä¸­çš„ HTML æ ‡ç­¾ if [content] { mutate { gsub =&gt; [ &#34;content&#34;, &#34;&lt;[^&gt;]*&gt;&#34;, &#34;&#34; # åˆ é™¤æ‰€æœ‰ HTML æ ‡ç­¾ï¼š&lt;p&gt;ã€&lt;div&gt;ã€&lt;span&gt; ç­‰ ] } \# å¯é€‰ï¼šè¿›ä¸€æ­¥æ¸…ç†å¤šä½™çš„ç©ºç™½å­—ç¬¦ mutate { gsub =&gt; [ &#34;content&#34;, &#34;\s&#43;&#34;, &#34; &#34; # å¤šä¸ªç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦ï¼‰åˆå¹¶ä¸ºä¸€ä¸ªç©ºæ ¼ ] } mutate { strip =&gt; [&#34;content&#34;] # å»é™¤é¦–å°¾ç©ºæ ¼ } } \# å¦‚æœ del_flag æ˜¯ 1ï¼Œæ ‡è®°è¯¥è®°å½•ç”¨äºåˆ é™¤ if [del_flag] == 1 { mutate { add_tag =&gt; [&#34;delete_document&#34;] } } } output { if &#34;delete_document&#34; in [tags] { elasticsearch { hosts =&gt; [&#34;http://elasticsearch:9200&#34;] user =&gt; &#34;elastic&#34; password =&gt; &#34;$ELASTIC_PASSWOR&#34; action =&gt; &#34;delete&#34; document_id =&gt; &#34;%{id}&#34; index =&gt; &#34;articles&#34; } } else { elasticsearch { hosts =&gt; [&#34;http://elasticsearch:9200&#34;] user =&gt; &#34;elastic&#34; password =&gt; &#34;$ELASTIC_PASSWOR&#34; index =&gt; &#34;articles&#34; # âœ… å›ºå®šç´¢å¼• document_id =&gt; &#34;%{id}&#34; # æ”¯æŒ varchar id doc_as_upsert =&gt; true # æ›´æ–°è¦†ç›– } } stdout { codec =&gt; rubydebug } } EOF \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- ç”Ÿæˆ docker-compose.yml &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- cat &gt; docker-compose.yml &lt;&lt; EOF services: elasticsearch: image: docker.elastic.co/elasticsearch/elasticsearch:$ES_VERSION container_name: elasticsearch environment: &amp;#8211; discovery.type=single-node &amp;#8211; ES_JAVA_OPTS=-Xms2g -Xmx2g &amp;#8211; xpack.security.enabled=true &amp;#8211; xpack.security.http.ssl.enabled=false &amp;#8211; ELASTIC_PASSWORD=$ELASTIC_PASSWORD ports: &amp;#8211; &#34;9200:9200&#34; volumes: &amp;#8211; ./data/es:/usr/share/elasticsearch/data &amp;#8211; ./config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml &amp;#8211; ./plugins/ik:/usr/share/elasticsearch/plugins/ik networks: &amp;#8211; elastic restart: unless-stopped healthcheck: test: [&#34;CMD-SHELL&#34;, &#34;curl -f http://localhost:9200 || exit 1&#34;] interval: 30s timeout: 10s retries: 3 kibana: image: docker.elastic.co/kibana/kibana:$LOGSTASH_VERSION container_name: kibana depends_on: elasticsearch: condition: service_healthy environment: &amp;#8211; ELASTICSEARCH_HOSTS=[&#34;http://elasticsearch:9200&#34;] &amp;#8211; ELASTICSEARCH_USERNAME=elastic &amp;#8211; ELASTICSEARCH_PASSWORD=$ELASTIC_PASSWORD &amp;#8211; SERVER_NAME=kibana.example.com &amp;#8211; I18N_LOCALE=zh-CN ports: &amp;#8211; &#34;5601:5601&#34; volumes: &amp;#8211; ./data/kibana:/usr/share/kibana/data networks: &amp;#8211; elastic restart: unless-stopped logstash: image: docker.elastic.co/logstash/logstash:$LOGSTASH_VERSION container_name: logstash depends_on: &amp;#8211; elasticsearch volumes: &amp;#8211; ./config/logstash.conf:/usr/share/logstash/pipeline/logstash.conf &amp;#8211; ./config/logstash.yml:/usr/share/logstash/config/logstash.yml &amp;#8211; ./logs/logstash:/var/log/logstash &amp;#8211; ./config/mysql:/usr/share/logstash/mysql networks: &amp;#8211; elastic restart: unless-stopped networks: elastic: driver: bridge EOF \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- ä¸‹è½½ MySQL JDBC é©±åŠ¨ &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- JDBC_JAR=&#34;config/mysql/mysql-connector-java-8.0.30.jar&#34; if [ ! -f &#34;$JDBC_JAR&#34; ]; then echo &#34;ğŸ“¥ ä¸‹è½½ MySQL JDBC é©±åŠ¨&amp;#8230;&#34; mkdir -p config/mysql wget -q https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.30/mysql-connector-java-8.0.30.jar -O &#34;$JDBC_JAR&#34; echo &#34;âœ… JDBC é©±åŠ¨ä¸‹è½½å®Œæˆ&#34; fi \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- è®¾ç½®æƒé™ &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- echo &#34;ğŸ” è®¾ç½®ç›®å½•æƒé™&#34; chown -R 1000:1000 data/es plugins/ik chmod -R 755 config logs chmod -R 777 data/kibana \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- ç”Ÿæˆåˆ›å»ºç´¢å¼•è„šæœ¬ &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- cat &gt; create-index.sh &lt;&lt; &amp;#8216;EOF&amp;#8217; #!/bin/bash echo &#34;ğŸ”„ æ­£åœ¨åˆ›å»ºç´¢å¼• &amp;#8216;articles&amp;#8217; å¹¶é…ç½® IK åˆ†è¯å™¨&amp;#8230;&#34; curl -X PUT &#34;http://localhost:9200/articles&#34; \ -u elastic:$ELASTIC_PASSWORD \ -H &#34;Content-Type: application/json&#34; \ -d &amp;#8216; { &#34;settings&#34;: { &#34;index&#34;: { &#34;number_of_shards&#34;: 1, &#34;number_of_replicas&#34;: 1 }, &#34;analysis&#34;: { &#34;analyzer&#34;: { &#34;ik_analyzer&#34;: { &#34;type&#34;: &#34;custom&#34;, &#34;tokenizer&#34;: &#34;ik_max_word&#34;, &#34;filter&#34;: [&#34;lowercase&#34;] } } } }, &#34;mappings&#34;: { &#34;properties&#34;: { &#34;id&#34;: { &#34;type&#34;: &#34;keyword&#34; }, &#34;title&#34;: { &#34;type&#34;: &#34;text&#34;, &#34;analyzer&#34;: &#34;ik_max_word&#34;, &#34;search_analyzer&#34;: &#34;ik_smart&#34; }, &#34;content&#34;: { &#34;type&#34;: &#34;text&#34;, &#34;analyzer&#34;: &#34;ik_max_word&#34;, &#34;search_analyzer&#34;: &#34;ik_smart&#34; }, &#34;author&#34;: { &#34;type&#34;: &#34;keyword&#34; }, &#34;created_at&#34;: { &#34;type&#34;: &#34;date&#34; }, &#34;updated_at&#34;: { &#34;type&#34;: &#34;date&#34; } } } }&amp;#8217; &amp;&amp; echo &#34;âœ… ç´¢å¼• &amp;#8216;articles&amp;#8217; åˆ›å»ºæˆåŠŸï¼&#34; EOF chmod &#43;x create-index.sh \# &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- å®Œæˆ &amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;&amp;#8212;- echo &#34;==================================================&#34; echo &#34;ğŸ‰ éƒ¨ç½²å‡†å¤‡å®Œæˆï¼&#34; echo &#34;==================================================&#34; echo &#34;&#34; echo &#34;ğŸ“Œ ä¸‹ä¸€æ­¥æ“ä½œï¼š&#34; echo &#34;1. æ£€æŸ¥é…ç½®ï¼šnano setup-elastic-sync.sh ï¼ˆä¿®æ”¹ MySQL åœ°å€ã€ç”¨æˆ·ã€å¯†ç ï¼‰&#34; echo &#34;2. å¢åŠ æƒé™ï¼šchmod &#43;x setup-elastic-sync.sh&#34; echo &#34;3. æ‰§è¡Œè„šæœ¬ï¼šsudo ./setup-elastic-sync.sh&#34; echo &#34;4. å¯åŠ¨æœåŠ¡ï¼šsudo docker compose up -d&#34; echo &#34;5. åˆ›å»ºç´¢å¼•ï¼šbash ./create-index.sh&#34; echo &#34;6. è®¿é—® Kibanaï¼šhttp://ä½ çš„æœåŠ¡å™¨IP:5601&#34; echo &#34; &amp;#8211; ç”¨æˆ·ï¼šelastic&#34; echo &#34; &amp;#8211; å¯†ç ï¼š$ELASTIC_PASSWORD&#34; echo &#34;&#34; echo &#34;ğŸ’¡ é¦–æ¬¡è¿è¡Œä¼šå…¨é‡åŒæ­¥ articles è¡¨ï¼Œä¹‹åæ¯ 2 åˆ†é’Ÿå¢é‡åŒæ­¥&#34; echo &#34;ğŸ” åœ¨ Kibana ä¸­æœç´¢ä¸­æ–‡ï¼ˆå¦‚â€œé˜¿é‡Œå·´å·´â€ï¼‰ï¼Œåº”èƒ½å‘½ä¸­ç»“æœ&#34; echo &#34;&#34; echo &#34;âš ï¸ æ³¨æ„ï¼šå¿…é¡»å…ˆè¿è¡Œ create-index.sh å†è®© Logstash å†™å…¥ï¼Œå¦åˆ™åˆ†è¯æ— æ•ˆï¼&#34; å¦‚æœ kibana ç”¨ elastic ç”¨æˆ·è¿ä¸ä¸Šï¼Œé€šè¿‡ Elasticsearch çš„ Security API ä¸ºå†…ç½®ç”¨æˆ· kibana_system ä¿®æ”¹å¯†ç ï¼š
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-28 09:26:14 +0000 +0000'>August 28, 2025</span>&nbsp;Â·&nbsp;<span>5 min</span>&nbsp;Â·&nbsp;<span>891 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to ä½¿ç”¨ docker ä¸€é”®éƒ¨ç½² ELK(åŒ…å«ä¸­æ–‡åˆ†è¯) æœåŠ¡è„šæœ¬" href="http://localhost:1313/posts/2025-08-28-%E4%BD%BF%E7%94%A8-docker-%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2-elk-%E6%9C%8D%E5%8A%A1%E8%84%9A%E6%9C%AC/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">å…³äº Redis incr çš„ä¸€ä¸ªé—®é¢˜
    </h2>
  </header>
  <div class="entry-content">
    <p>å‰ä¸€æ®µæ—¶é—´æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦è®¡æ•°ï¼Œç†æ‰€å½“åœ°çš„ä½¿ç”¨äº† redis çš„ incr æ–¹æ³•ã€‚ä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š
@Scheduled(cron = &#34;0 0/10 \* \* * ?&#34;) public void test() { long yellowInterval = 5L; boolean isReachable = false; // TODO long delta = isReachable ? -1L : 1L; ValueOperations&lt;String, Long&gt; valueOperations = redisTemplate.opsForValue(); String key = RFID_NETWORK_STATUS_PREFIX &#43; rfDevice.getId(); Long increment = valueOperations.increment(key, delta); if (increment == null || increment &lt;= 0L) { } } else if (increment &gt;= yellowInterval) { if (Constants.RFID_NETWORK_STATUS_GREEN.equals(rfDevice.getNetworkStatus())) { } if (increment &gt;= yellowInterval * 3) { valueOperations.set(key, yellowInterval * 3); } } å¤§æ¦‚å°±æ˜¯æŸä¸ªæ“ä½œä¹‹åè®°ä¸€ä¸‹æ•°ï¼ŒåŠ ä¸€æˆ–è€…å‡ä¸€ï¼Œå¦‚æœåŠ åˆ°äº†æŸä¸ªå€¼ï¼Œå°±æŠŠå®ƒè®¾ç½®ä¸ºæŸä¸ªå€¼ã€‚æˆ‘ä»¬è¿™é‡Œå…ˆä¸è€ƒè™‘å¹¶å‘é—®é¢˜ã€‚ç»“æœåœ¨è¿è¡Œçš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-07-30 10:23:46 +0000 +0000'>July 30, 2025</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>274 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to å…³äº Redis incr çš„ä¸€ä¸ªé—®é¢˜" href="http://localhost:1313/posts/2025-07-30-%E5%85%B3%E4%BA%8E-redis-incr-%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Gradle é¡¹ç›®æ‰“åŒ…æ„å»ºä¸­çš„ä¸¤ä¸ªå°é—®é¢˜
    </h2>
  </header>
  <div class="entry-content">
    <p> æ‰“åŒ…çš„æ—¶å€™æŠ¥é”™ï¼Œæç¤º jar é‡å¤ï¼Œå…·ä½“è¯¦æƒ…ï¼š * What went wrong: Execution failed for task &amp;#8216;:web-admin:bootJar&amp;#8217;. &gt; Entry BOOT-INF/lib/jaxb-core-4.0.3.jar is a duplicate but no duplicate handling strategy has been set. Please refer to https://docs.gradle.org/7.6.3/dsl/org.gradle.api.tasks.Copy.html#org.gradle.api.tasks.Copy:duplicatesStrategy for details. * Try: &gt; Run with &amp;#8211;stacktrace option to get the stack trace. &gt; Run with &amp;#8211;info or &amp;#8211;debug option to get more log output. &gt; Run with &amp;#8211;scan to get full insights. åœ¨æ‰“åŒ…Spring Bootåº”ç”¨æ—¶ï¼ŒBOOT-INF/lib/jaxb-core-4.0.3.jar æ–‡ä»¶å‡ºç°äº†é‡å¤é¡¹ï¼Œè€Œæ„å»ºè„šæœ¬ä¸­æ²¡æœ‰è®¾ç½®å¤„ç†é‡å¤æ–‡ä»¶çš„ç­–ç•¥ã€‚Gradleä¸å…è®¸é»˜è®¤æƒ…å†µä¸‹å­˜åœ¨é‡å¤æ–‡ä»¶ï¼Œå› æ­¤æ„å»ºå¤±è´¥ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªä¿®æ”¹æ„å»ºé…ç½®ï¼š
bootJar { duplicatesStrategy = DuplicatesStrategy.EXCLUDE } è¿™æ®µä»£ç å‘Šè¯‰ Gradle åœ¨å‘ç°é‡å¤æ–‡ä»¶æ—¶æ’é™¤å®ƒä»¬ã€‚æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–ç­–ç•¥å¦‚ DuplicatesStrategy.INCLUDE æˆ–è€… DuplicatesStrategy.WARNã€‚ç„¶åæ¸…ç†å’Œé‡æ–°æ„å»ºé¡¹ç›®å³å¯ã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-05-17 07:42:46 +0000 +0000'>May 17, 2025</span>&nbsp;Â·&nbsp;<span>1 min</span>&nbsp;Â·&nbsp;<span>144 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to Gradle é¡¹ç›®æ‰“åŒ…æ„å»ºä¸­çš„ä¸¤ä¸ªå°é—®é¢˜" href="http://localhost:1313/posts/2025-05-17-gradle-%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E6%9E%84%E5%BB%BA%E4%B8%AD%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%B0%8F%E9%97%AE%E9%A2%98/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">nginx ä»£ç† sse æ¥å£ï¼ŒæŠ¥ï¼š(failed) net::ERR HTTP2 PROTOCOL ERROR
    </h2>
  </header>
  <div class="entry-content">
    <p>å‰ä¸€æ®µæ—¶é—´æ›¾å†™äº†ä¸€ç¯‡å…³äºSpring MVC é€šè¿‡ SSE å®ç°æ¶ˆæ¯æ¨é€çš„å°æ–‡ç« ï¼Œåæ¥ç³»ç»Ÿä¸Šçº¿çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªå°é—®é¢˜ï¼Œæ‰“å¼€æµè§ˆå™¨çš„ networkï¼Œçœ‹åˆ°æ¥å£æŠ¥ï¼š(failed) net::ERR HTTP2 PROTOCOL ERRORï¼Œé€šå¸¸æ˜¯å› ä¸º HTTP/2 åè®®ä¸ SSE çš„æŸäº›ç‰¹æ€§ä¸å…¼å®¹æ‰€å¯¼è‡´çš„ã€‚SSE æ˜¯åŸºäº HTTP åè®®çš„æœåŠ¡å™¨æ¨é€æŠ€æœ¯ï¼Œå®ƒè¦æ±‚è¿æ¥ä¿æŒæ‰“å¼€çŠ¶æ€ä»¥ä¾¿æœåŠ¡å™¨å¯ä»¥æŒç»­å‘é€æ›´æ–°ç»™å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬ä½¿ç”¨çš„ nginx version æ˜¯ï¼šnginx/1.26.1
åªéœ€è¦æŒ‰å¦‚ä¸‹é…ç½®å³å¯è§£å†³ï¼š
server { listen 80; server_name bridgeli.com; access_log /var/log/nginx/bridgeli_access.log; error_log /var/log/nginx/bridgeli_error.log warn; location ^~ /admin-api/ { proxy_pass http://192.168.124.34:8080/; \# ç¡®ä¿ä½¿ç”¨HTTP/1.1æ¥æ”¯æŒSSE proxy_http_version 1.1; \# å…³é—­ä»£ç†è¿æ¥çš„â€œConnectionâ€å¤´ï¼Œä»¥é¿å…æ½œåœ¨çš„é—®é¢˜ proxy_set_header Connection &amp;#8221;; \# å¢åŠ è¶…æ—¶è®¾ç½®ï¼Œç¡®ä¿é•¿æ—¶é—´è¿æ¥ä¸ä¼šè¢«å…³é—­ proxy_read_timeout 86400s; proxy_send_timeout 86400s; \# å¦‚æœéœ€è¦ç¦ç”¨HTTP/2ï¼ˆå¯é€‰ï¼‰ \# æ³¨æ„ï¼šè¿™ä¸ªè®¾ç½®æ˜¯åœ¨serverå—ä¸­ï¼Œè€Œä¸æ˜¯locationå—ä¸­ \# listen 80 http2 off; å¯¹äºHTTP/2åè®®é”™è¯¯ç‰¹åˆ«æœ‰ç”¨ } location / { root /project/www/bridgeli/admin/; try_files $uri $uri/ /index.html; } } </p>
  </div>
  <footer class="entry-footer"><span title='2025-04-03 07:49:30 +0000 +0000'>April 3, 2025</span>&nbsp;Â·&nbsp;<span>1 min</span>&nbsp;Â·&nbsp;<span>75 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to nginx ä»£ç† sse æ¥å£ï¼ŒæŠ¥ï¼š(failed) net::ERR HTTP2 PROTOCOL ERROR" href="http://localhost:1313/posts/2025-04-03-nginx-%E4%BB%A3%E7%90%86-sse-%E6%8E%A5%E5%8F%A3%E6%8A%A5failed-neterr-http2-protocol-error/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">å…³äº druid ç›‘æ§çš„ä¸¤ä¸ªå°é—®é¢˜
    </h2>
  </header>
  <div class="entry-content">
    <p>å‰ä¸€æ®µæ—¶é—´åšä¸€ä¸ªå°éœ€æ±‚ï¼Œéœ€è¦å±•ç¤º druid çš„ç›‘æ§é¡µé¢ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ druid ç›‘æ§åœ°å€æ˜¯ï¼šhttp://ip:port/druid/index.htmlï¼Œä½†æ˜¯å½“æ—¶ä¸€ç›´æŠ¥ 404ï¼Œåæ¥æŸ¥äº†èµ„æ–™ï¼Œå¼•å…¥çš„ jar åŒ…ï¼š
&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.2.24&lt;/version&gt; &lt;/dependency&gt; åº”è¯¥æ˜¯å› ä¸ºä¸æ˜¯é€šè¿‡ starter åŒ…å¼•å…¥çš„ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨é…ç½®ï¼š
package cn.bridgeli.demo; import com.alibaba.druid.support.jakarta.StatViewServlet; import com.alibaba.druid.support.jakarta.WebStatFilter; import com.alibaba.druid.util.Utils; import jakarta.servlet.Filter; import jakarta.servlet.FilterChain; import jakarta.servlet.ServletException; import jakarta.servlet.ServletRequest; import jakarta.servlet.ServletResponse; import org.springframework.boot.web.servlet.FilterRegistrationBean; import org.springframework.boot.web.servlet.ServletRegistrationBean; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import java.io.IOException; @Configuration public class DruidConfig { @Bean public ServletRegistrationBean&lt;StatViewServlet&gt; statViewServlet() { ServletRegistrationBean&lt;StatViewServlet&gt; servletRegistrationBean = new ServletRegistrationBean&lt;&gt;(new StatViewServlet(), &#34;/druid/*&#34;); // è®¾ç½®ç™»å½•ç”¨æˆ·åå’Œå¯†ç  servletRegistrationBean.addInitParameter(&#34;loginUsername&#34;, &#34;BridgeLi&#34;); servletRegistrationBean.addInitParameter(&#34;loginPassword&#34;, &#34;BridgeLi&#34;); return servletRegistrationBean; } @Bean public FilterRegistrationBean&lt;WebStatFilter&gt; webStatFilter() { FilterRegistrationBean&lt;WebStatFilter&gt; filterRegistrationBean = new FilterRegistrationBean&lt;&gt;(new WebStatFilter()); filterRegistrationBean.addUrlPatterns(&#34;/*&#34;); filterRegistrationBean.addInitParameter(&#34;exclusions&#34;, &#34;\*.js,\*.gif,\*.jpg,\*.png,\*.css,\*.ico,/druid/*&#34;); return filterRegistrationBean; } } å¦å¤–ä¸€ä¸ªå°é—®é¢˜å°±æ˜¯ï¼Œè¿™ä¹ˆå¼•å…¥ä¹‹åï¼Œæ‰“å¼€ç›‘æ§é¡µæœ€ä¸‹é¢ä¼šæœ‰ alibaba çš„å¹¿å‘Šï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯æƒ³å»æ‰çš„ï¼Œå¹¿å‘Šä»£ç æ‰€åœ¨çš„ä½ç½®åœ¨ support/http/resources/js/common.js è¿™ä¸ª js é‡Œé¢ï¼Œç½‘ä¸Šæœ‰äººè¯´ç›´æ¥è§£å‹åˆ æ‰ï¼Œé‡æ–°æ‰“åŒ…å°±è¡Œäº†ï¼Œä½†æ˜¯è¿™ä¸ªæœ‰é—®é¢˜å°±æ˜¯å¿…é¡»ç”¨é‡æ–°æ‰“åŒ…çš„è¿™ä¸ª jarï¼Œæœäº†ä¸€ä¸‹èµ„æ–™ï¼Œå…¶å®å»æ‰ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ä¸Šé¢çš„é‚£ä¸ªç±»é‡Œé¢å¢åŠ ä¸€ä¸ª é…ç½®è¿‡æ»¤æ‰å³å¯ï¼š
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-03-12 09:44:14 +0000 +0000'>March 12, 2025</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>310 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to å…³äº druid ç›‘æ§çš„ä¸¤ä¸ªå°é—®é¢˜" href="http://localhost:1313/posts/2025-03-12-%E5%85%B3%E4%BA%8E-druid-%E7%9B%91%E6%8E%A7%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%B0%8F%E9%97%AE%E9%A2%98/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Spring MVC é€šè¿‡ SSE å®ç°æ¶ˆæ¯æ¨é€
    </h2>
  </header>
  <div class="entry-content">
    <p>åˆå¥½ä¹…æ²¡æœ‰å†™æ–‡ç« äº†ï¼Œè‡ªä»æœ‰äº†å¤§æ¨¡å‹ä¹‹åå†™æ–‡ç« çš„æ€åº¦è¶Šæ¥è¶Šæä¸èµ·å…´è¶£äº†ï¼Œæœ‰é—®é¢˜ï¼Œç›´æ¥é—®å¤§æ¨¡å‹å³å¯ã€‚å‰å‡ å¤©å…¬å¸æœ‰ä¸ªéœ€æ±‚ï¼Œæƒ³ç”¨ SSE å®ç°ï¼Œä¹‹å‰ä»æ²¡å†™è¿‡ï¼Œæ‰€ä»¥è®©å¤§æ¨¡å‹ç›´æ¥å†™ï¼Œç„¶åå®ç°è¶…çº§ç®€å•ï¼š
ç¼–å†™ SSE æœåŠ¡ï¼Œæ¥è¿›è¡Œåˆ›å»ºé“¾æ¥å’Œå‘é€æ¶ˆæ¯ package cn.bridgeli.demo; import lombok.Getter; import lombok.extern.slf4j.Slf4j; import org.apache.commons.collections4.CollectionUtils; import org.springframework.stereotype.Service; import org.springframework.web.servlet.mvc.method.annotation.SseEmitter; import java.io.IOException; import java.util.List; import java.util.Map; import java.util.concurrent.ConcurrentHashMap; @Slf4j @Getter @Service public class SseService { private final Map&lt;String, SseEmitter&gt; emitters = new ConcurrentHashMap&lt;&gt;(); public SseEmitter stream(String usrId) { SseEmitter emitter = emitters.computeIfAbsent(usrId, k -&gt; new SseEmitter(Long.MAX_VALUE)); emitter.onCompletion(() -&gt; { log.info(&#34;SSE emitter completed&#34;); emitters.remove(usrId); }); emitter.onError((throwable) -&gt; { log.error(&#34;Error occurred in SSE emitter&#34;, throwable); emitter.complete(); emitters.remove(usrId); }); emitter.onTimeout(() -&gt; { log.warn(&#34;SSE emitter timed out&#34;); emitter.complete(); emitters.remove(usrId); }); // å¯é€‰ï¼šè¿æ¥æˆåŠŸæ—¶å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªåˆå§‹äº‹ä»¶ try { emitter.send(SseEmitter.event().name(&#34;connect&#34;).data(&#34;è¿æ¥æˆåŠŸ&#34;)); } catch (IOException e) { log.error(&#34;Error occurred while sending initial event&#34;, e); emitter.completeWithError(e); } return emitter; } public void send(List&lt;String&gt; userIds, String name, Object object) { if (!emitters.isEmpty()) { // éå†æ‰€æœ‰ç”¨æˆ·çš„ SseEmitterï¼Œæ¨é€æ•°æ® if (CollectionUtils.isEmpty(userIds)) { emitters.forEach((userId, emitter) -&gt; { try { emitter.send(SseEmitter.event().name(name).data(object)); } catch (IOException e) { // å¦‚æœå‘é€å¤±è´¥ï¼Œåˆ™ç§»é™¤è¯¥ç”¨æˆ·çš„ emitter log.error(&#34;Error occurred while sending event to user {}&#34;, userId, e); emitter.completeWithError(e); emitters.remove(userId); } }); } else { userIds.forEach(userId -&gt; { SseEmitter emitter = emitters.get(userId); if (emitter != null) { try { emitter.send(SseEmitter.event().name(name).data(object)); } catch (IOException e) { // å¦‚æœå‘é€å¤±è´¥ï¼Œåˆ™ç§»é™¤è¯¥ç”¨æˆ·çš„ emitter log.error(&#34;Error occurred while sending event to user {}&#34;, userId, e); emitter.completeWithError(e); emitters.remove(userId); } } }); } } } } ç¼–å†™å¯¹åº”çš„ Controller ç»™å‰ç«¯æä¾›æ¥å£ï¼š package cn.bridgeli.demo; import cn.bridgeli.BaseAuthController; import io.swagger.v3.oas.annotations.tags.Tag; import jakarta.annotation.Resource; import lombok.extern.slf4j.Slf4j; import org.springframework.http.MediaType; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.servlet.mvc.method.annotation.SseEmitter; @Slf4j @RestController @Tag(name = &#34;SSE æ¨é€æœåŠ¡&#34;) @RequestMapping(&#34;/auth/common/sse&#34;) public class SseController extends BaseAuthController { @Resource private SseService sseService; @GetMapping(value = &#34;/stream&#34;, produces = MediaType.TEXT_EVENT_STREAM_VALUE) public SseEmitter stream() { return sseService.stream(getLoginUsr().getUsrId()); } } æ¶ˆæ¯æ¨é€å…·ä½“å®ç°ï¼š package cn.bridgeli.demo; import cn.bridgeli.common.SseService; import cn.bridgeli.monitor.MonitorService; import cn.bridgeli.vo.CpuInfoVo; import jakarta.annotation.Resource; import lombok.extern.slf4j.Slf4j; import org.springframework.scheduling.annotation.Scheduled; import org.springframework.stereotype.Component; import org.springframework.web.servlet.mvc.method.annotation.SseEmitter; import java.util.Map; @Component @Slf4j public class ScheduledTask { @Resource private MonitorService monitorService; @Resource private SseService sseService; /** * æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ */ @Scheduled(cron = &#34;0 0/1 \* \* * ?&#34;) public void updateOrderStatus() { log.info(&#34;=============å®šæ—¶ä»»åŠ¡=============&#34;); Map&lt;String, SseEmitter&gt; emitters = sseService.getEmitters(); if (null == emitters || emitters.isEmpty()) { log.info(&#34;sse emitters is empty&#34;); return; } CpuInfoVo cpuData = monitorService.getCpuData(); sseService.send(null, &#34;cpu&#34;, cpuData); } } å…¶å®å°±æ˜¯å‰ç«¯è¿æ¥ä¹‹ååˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œä¿å­˜è¿æ¥ï¼Œç„¶ååˆ«çš„åœ°æ–¹äº§ç”Ÿæ¶ˆæ¯ï¼Œæ¨é€æ¶ˆæ¯ï¼Œæˆ‘çš„å®ä¾‹æ˜¯é€šè¿‡ oshi è·å– CPU ä½¿ç”¨ç‡ï¼Œå®ç°å¯¹ CPU çš„å®æ—¶ç›‘æ§ã€‚
</p>
  </div>
  <footer class="entry-footer"><span title='2025-02-27 01:26:08 +0000 +0000'>February 27, 2025</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>338 words</span>&nbsp;Â·&nbsp;<span>Bridge Li</span></footer>
  <a class="entry-link" aria-label="post link to Spring MVC é€šè¿‡ SSE å®ç°æ¶ˆæ¯æ¨é€" href="http://localhost:1313/posts/2025-02-27-spring-mvc-%E9%80%9A%E8%BF%87-sse-%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="next" href="http://localhost:1313/posts/page/2/">Next&nbsp;&nbsp;Â»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">åˆ†äº«æŠ€æœ¯å¸¦æ¥çš„å–œæ‚¦</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
